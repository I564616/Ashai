/*! fedscaffold 2022-06-28 */
function waitForElement(){if("undefined"!=typeof angular){var a=angular.module("CUB",["ngAnimate","NgSwitchery","breakpointApp","ngSanitize","ui.bootstrap","ngTouch"]).service("angularUtils",function(){return{arrayContains:function(a,b){for(var c in a)if(a[c]===b)return!0;return!1}}}).service("globalMessageService",function(){var a="",b="";return{setMessage:function(c,d){a=c,b=d},getMessageType:function(){return a},getMessage:function(){return b},watch:function(){return{currentMessageType:a,currentMessage:b}}}});a.config(["$httpProvider",function(a){a.defaults.headers.post.CSRFToken=ACC.config.CSRFToken}]),a.controller("formsCtrl",["$scope","$http","$window","globalMessageService",function(a,b,c,d){function e(){$(".current-selected .current-active").addClass("hide"),$(".current-selected .current-inactive").removeClass("hide"),$(".current-selected .active-inactive").attr("data-value",0),$(".current-selected .bde-view-only").attr("data-active","false"),$(".current-selected").removeClass("current-selected"),$("html,body").animate({scrollTop:0},"500")}a.init=function(){a.bdeViewOnly=!1,$(".view-only-mode").length&&(a.bdeViewOnly=!0)};var f=void 0!==$("#bdeUserEmailIds").val()?$("#bdeUserEmailIds").val().split(","):"",g=void 0!==$("#customerEmailIds").val()?$("#customerEmailIds").val().split(","):"";void 0!==$("#ccValidationData").html()&&(a.ccValidationData=JSON.parse($("#ccValidationData").html())),$(".allowNumericOnly").on("keyup input",function(a){var b=$(this);/\D/g.test(b.val())&&b.val(b.val().replace(/\D/g,""))}),a.cardType="",a.cvvLength=0,a.cardLength=16,a.isCardNumberValid=!0,$(".ccValidation").on("keyup keypress",function(b){var c=$(this).val();void 0!==a.ccValidationData&&(a.cardType="",a.cvvLength=0,a.cardLength=16,angular.forEach(a.ccValidationData,function(d){void 0!==d&&(void 0!==d.digitValidation&&d.digitValidation.length>0&&angular.forEach(d.digitValidation,function(e){parseInt(a.getInputByDigits(b,d.digitValidation.length))===parseInt(e)&&c.length===parseInt(d.lengthValidation)&&(a.cardType=d.cardType,a.cardLength=parseInt(d.lengthValidation),a.cvvLength=parseInt(d.cvvValidation),$("#cardType").val(d.cardType),a.isCardNumberValid=!0)}),void 0!==d.seriesValidation&&d.seriesValidation.length>0&&angular.forEach(d.seriesValidation,function(e){var f=e.split(":"),g=f[0],h=f[1];if(parseInt(a.getInputByDigits(b,g.length))>=parseInt(g)&&parseInt(a.getInputByDigits(b,h.length))<=parseInt(h)&&c.length===parseInt(d.lengthValidation))return a.cardType=d.cardType,a.cardLength=parseInt(d.lengthValidation),a.cvvLength=parseInt(d.cvvValidation),$("#cardType").val(d.cardType),a.isCardNumberValid=!0,b.stopImmediatePropagation(),b.preventDefault(),!1}))})),a.$apply(),$(this).attr("maxlength",a.cardLength)}),a.isExpiryDateInvalid=!1,$(".expiryDateMonth, .expiryDateYear").on("change",function(b){a.isExpiryMonthAndYearValid()}),a.isExpiryMonthAndYearValid=function(){var b=new Date,c=b.getFullYear()+"",d=c.substr(2,2),e=b.getMonth()+1;return d===$(".expiryDateYear").val()&&$(".expiryDateMonth").val()&&$(".expiryDateMonth").val()<e?(a.ccForm.expiryDateMonth.$setValidity("expiryMonth",!1),a.ccForm.expiryDateYear.$setValidity("expiryYear",!1),a.isExpiryDateInvalid=!0,!1):$(".expiryDateMonth").val()&&$(".expiryDateYear").val()?(a.ccForm.expiryDateMonth.$setValidity("expiryMonth",!0),a.ccForm.expiryDateYear.$setValidity("expiryYear",!0),a.isExpiryDateInvalid=!1,!0):void a.$apply()},a.emailIds={users:[],customers:[]};for(var h=0;h<f.length;h++)a.emailIds.users.push({email:f[h]});for(var i=0;i<g.length;i++)a.emailIds.customers.push({email:g[i]});a.userEmailIds=a.emailIds.users,a.custEmailIds=a.emailIds.customers;var j,k;if(a.checkEmailType=function(b){"users"===b?(j=a.userEmail,k=a.userEmailIds):"customers"===b?(j=a.custEmail,k=a.custEmailIds):j=void 0},a.addNewEmailFor=function(b){if(a.checkEmailType(b),void 0!=j&&j.length>0){if(!a.isValidEmailAddress(j,b))return!1;var c={email:j};k.push(c),"users"===b?a.userEmailCheckEnabled=!0:"customers"===b&&(a.custEmailCheckEnabled=!0),a.validateFormTextField()}a.custEmail="",a.userEmail=""},a.isValidEmailAddress=function(a,b){var c=/[a-z0-9](\.?[a-z0-9])@cub\.com\.au$/g,d=/[a-z0-9._%+-]+@(?!cub.com.au)(?!au.ab-inbev.com)(?!au.sabmiller.com)(?!beercollective.com.au)(?!fostersgroup.com.au)[a-z0-9-.]+(\.[a-z])?$/g;if($("#cubEmailAddressError, #custEmailAddressError").css("color","#ff0000"),"users"===b){if(!c.test(a))return $("#cubEmailAddressError").attr("class","visible"),!1;$("#cubEmailAddressError").attr("class","invisible")}else if("customers"===b){if(!d.test(a))return $("#custEmailAddressError").attr("class","visible"),!1;$("#custEmailAddressError").attr("class","invisible")}return!0},a.isNumeric=function(a,b){var c=a.keyCode||a.charCode||a.which,d=$(a.currentTarget).val();if(parseInt($(a.currentTarget).val().length)>=b&&($(' + input[type="hidden"]',a.currentTarget).val(d),8!==c))return a.stopImmediatePropagation(),a.preventDefault(),!1;$(a.currentTarget).attr("maxlength",b)},a.validateFormTextField=function(){for(var b=$('input[id^="userEmail"]:checked').length,c=$('input[id^="custEmail"]:checked').length,d=0;d<a.userEmailIds.length;d++)$("#userEmail"+d).is(":checked")&&(a.userEmailCheckEnabled=!0);for(var e=0;e<a.custEmailIds.length;e++)$("#custEmail"+e).is(":checked")&&(a.custEmailCheckEnabled=!0);void 0!=a.orderDetailsTextarea&&a.orderDetailsTextarea.length>3&&(a.orderDetailTextareaEnabled=!0),0==b&&(a.userEmailCheckEnabled=!1),0==c&&(a.custEmailCheckEnabled=!1),a.userEmailCheckEnabled&&a.custEmailCheckEnabled&&a.orderDetailTextareaEnabled?a.saveDetailsEnabled=!0:a.saveDetailsEnabled=!1,a.orderDetailTextareaEnabled=!1},a.saveDetails=function(){a.BdeOrderDetailsForm={users:[],customers:[],emailText:""},$.each($("input[id*='userEmail']:checked"),function(){a.BdeOrderDetailsForm.users.push({email:$(this).val()})}),$.each($("input[id*='custEmail']:checked"),function(){var b=$(this).val(),c=b.indexOf(":")>-1?b.substring(0,b.indexOf(":")):b,d=b.indexOf(":")>-1?b.substring(b.indexOf(":")+1,b.length):"";a.BdeOrderDetailsForm.customers.push({email:c,firstName:d})}),a.BdeOrderDetailsForm.emailText=a.orderDetailsTextarea,b.post($("#updateBDEOrderDetailsUrl").val(),a.BdeOrderDetailsForm).success(function(a,b){$("#bdeOrderModal3").css("visibility","hidden"),$(".modal-backdrop").removeClass("modal-backdrop fade in"),$("body").removeClass("modal-open")}).error(function(a,b){})},$('[id^="bdeOrderModal"]').on("shown.bs.modal",function(){$("#bdeOrderModal1, #bdeOrderModal2").find(".modal-content").css("height",.3*$(window).height()),$(this).find(".modal-body").css("height","100%"),$("body").addClass("modal-open")}),$("#bdeOrderModal1").modal("show"),$("#bdeOrderCheckbox").on("click",function(){$(this).is(":checked")&&($("#bdeOrderModal1").css("visibility","hidden"),$("#bdeOrderModal2").modal("show"))}),$("#bdeOrderModal2").on("shown.bs.modal",function(){setTimeout(function(){$("#bdeOrderModal2").css("visibility","hidden"),$("#bdeOrderModal3").modal("show")},2e3)}),$('[id^="bdeOrderModal"]').on("hide.bs.modal",function(){window.location.href="cart"}),a.modalClose=function(){a.bsb="",a.accountNumber="",a.accountName="",a.agreeTerms=!1,a.cardNumber="",a.cardName="",a.cvn="",a.expiryMonth="",a.expiryYear="",a.eftForm.$setPristine(),a.eftForm.$setUntouched(),a.ccForm.$setPristine(),a.ccForm.$setUntouched(),a.ccForm.submitted=!1,a.eftForm.submitted=!1,a.$apply()},a.resetCCForm=function(){a.cardNumber="",a.cardName="",a.cvn="",a.cardType="",a.expiryDateMonth="",a.expiryDateYear="",a.ccForm.$setPristine(),a.ccForm.$setUntouched(),$("#Invalid_Expiry_Date").addClass("ng-hide"),a.ccForm.submitted=!1},a.resetEFTForm=function(){a.bsb="",a.accountNumber="",a.accountName="",a.agreeTerms=!1,a.cardNumber="",a.cardName="",a.cvn="",a.expiryMonth="",a.expiryYear="",a.eftForm.$setPristine(),a.eftForm.$setUntouched(),$("#invalidExpiryDate").addClass("hide"),a.eftForm.submitted=!1},a.ccBillingFormInit=function(){ccForm.submitted=!1,a.payBy="CREDIT_CARD"},a.ccCheckoutFormInit=function(){a.continuePayment=!1,a.accountType,ccForm.submitted=!1,a.$watchCollection("[ccForm.$valid,accountType]",function(){var b=a.ccForm.$valid;"payByAccount"==a.accountType&&(b=!0),a.continuePayment=b})},a.getInputByDigits=function(a,b){for(var c=angular.element(a.currentTarget).val(),d=[],e=0;e<parseInt(b);e++)d.push(c[e]);return d.join("")},a.serviceRequestInit=function(){},a.userInit=function(){a.user=JSON.parse($("#userData").html()),a.user.phoneNumber=$("#phoneNumber").val(),a.noInactiveBU=!0,a.$watch("createUser.$valid",function(b){b&&(a.notComplete=!1)}),a.checkForInactiveBU()},a.invokeUnsavedChangesPopUp=function(){a.checkUserProfileFormIfUpdated()?($("body").addClass("unsaved-changes"),a.profileFormValid=!0):a.profileFormValid=!1},a.checkUserProfileFormIfUpdated=function(){if(void 0!==a.user.agreeTerms&&void 0!==a.user.ofAge){if(!($("#register_phoneNumber").val().length>0))return!0;var b=/^\({0,1}((0)(4)){0,1}\){0,1}(\ ){0,1}[0-9]{2}(\ ){0,1}[0-9]{2}(\ ){0,1}[0-9]{1}(\ ){0,1}[0-9]{3}$/,c=$(".phone-number.error");if(void 0==a.isMobileNumberValid)$("#register_phoneNumber").blur();else if(a.isMobileNumberValid)return b.test($("#register_phoneNumber").val())?(c.addClass("hide"),!0):(c.removeClass("hide"),!1)}},a.printForm=function(b){var b=a.sr.type,c={};c=a.sr,c.request=a[b]},a.$watch("editUser.$valid",function(b){b&&(a.notComplete=!1)}),a.checkForInactiveBU=function(){for(state in a.user.states)for(venue in a.user.states[state].b2bunits)a.user.states[state].b2bunits[venue].active||(a.noInactiveBU=!1)},a.isAllInactive=!1,a.isAllSelected=function(b){for(state in b)for(venue in b[state].b2bunits)if(b[state].b2bunits[venue].active)return a.isAllInactive=!0,!0},a.openDisableModal=function(a){$.magnificPopup.open({items:{src:"#deactivateUserPopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",closeMarkup:'<div class="mfp-close"><svg class="icon-cross"><use xlink:href="#icon-cross"></use></span></div>'})},a.closeDisableModal=function(b,c){$.magnificPopup.close(),a.selectAllState(b,c)},a.selectAllState=function(b,c){for(var d=0;d<c.length;d++)c[d].disabled||(c[d].selected=b),a.selectAll(c[d])},a.selectAll=function(a){if(a.selected)for(venue in a.b2bunits)a.b2bunits[venue].active&&(a.b2bunits[venue].selected=!0);else for(venue in a.b2bunits)a.b2bunits[venue].active&&(a.b2bunits[venue].selected=!1)},a.someSelected=function(){var b=!1;for(p in a.user.permissions)a.user.permissions[p]&&(b=!0);return b},a.stateDisabled=function(a){for(bu in a.b2bunits)if(!0===a.b2bunits[bu].active)return!1;return!0},a.stateSelected=function(a){for(bu in a.b2bunits)if(!0!==a.b2bunits[bu].selected)return!1;return!0},$("body").hasClass("page-editUser")||$("body").hasClass("page-createUser")){a.user={};var l;$("#register_phoneNumber").css("background","#fff"),$("#register_phoneNumber").on("focus",function(){if(l=$(this),0===l.val().length)l.val("04"),l[0].setSelectionRange(2,2);else{var a=l.val(),b=a.length;l[0].setSelectionRange(b,b)}}).keydown(function(a){var b=a.charCode||a.keyCode||0;return l=$(this),8!==b&&9!==b&&(4===l.val().length&&l.val(l.val()+" "),8===l.val().length&&l.val(l.val()+" ")),8==b||9==b||46==b||b>=48&&b<=57||b>=96&&b<=105}).blur(function(){l=$(this);var b=$(".phone-number.error"),c=/[0-9 ]$/g;"04"===l.val()||""===l.val()?(l.val(""),$("#mobileNumber").val(""),b.addClass("hide"),a.isMobileNumberValid=!0):l.val().trim().charAt(0)+l.val().trim().charAt(1)==="04"&&12===l.val().length&&c.test(l.val())?(b.addClass("hide"),a.isMobileNumberValid=!0):(b.removeClass("hide"),a.isMobileNumberValid=!1)})}a.emailChecker=function(c){$("body").addClass("loading");var d=$(".checkUserUrl").val(),c=$(".email-checker").val();if(a.createUser.email.$valid){var e={};e.email=c,b.get(d,{params:e}).success(function(b){b.self?(a.user.thisZADP=!1,a.user.exists=!1,a.user.self=b.self):(a.user.self=b.self,b.exists?b.thisZADP?(a.emailExists=!0,a.user=b):(a.emailExists=!0,a.user.thisZADP=b.thisZADP,a.user.exists=b.exists):(a.user.thisZADP=!1,a.user.exists=!1,a.user.states=b.states,a.user.permissions=b.permissions)),$("body").removeClass("loading")}).error(function(){})}else $("body").removeClass("loading")},a.userActivate=function(a,c,f){var g={};g.businessCustomerActive=f,g.businessCustomerUid=$("#deleteOrDeactivatePopup").find(".btn-primary").data("cuid"),g.businessUnitId=$("#deleteOrDeactivatePopup").find(".btn-primary").data("buid"),b.post(a,g).success(function(a){d.setMessage(a.messageType,a.message),$.magnificPopup.close(),e()}).error(function(){})},a.createUserSubmit=function(e){var f=$("#sabmCreateUserForm").attr("action");if(a.someSelected()||(e.$valid=!1),a.user.b2bUnitId=$(".b2bUnitId").val(),e.$valid){var g="/sabmStore/en/register/isExistingUser/"+e.email.$modelValue+"?createUser=true";b.get(g).success(function(e){"TRUE"===e?$.magnificPopup.open({items:{src:"#forgotpwd-popup",type:"inline"},callbacks:{open:function(){$("#submit_button").on("click",function(){b.post(f,a.user).success(function(a){if("good"===a.messageType)return c.location.href=$(".baseUrl").val()+a.redirectUrl+"?message="+a.message+"&messageType="+a.messageType;$.magnificPopup.close(),d.setMessage(a.messageType,a.message),$("html,body").animate({scrollTop:0},"500")}).error(function(){$.magnificPopup.close()})})}}}):b.post(f,a.user).success(function(a){if("good"===a.messageType)return c.location.href=$(".baseUrl").val()+a.redirectUrl+"?message="+a.message+"&messageType="+a.messageType;d.setMessage(a.messageType,a.message),$("html,body").animate({scrollTop:0},"500")}).error(function(){})}),a.notComplete=!1}else a.notComplete=!0},a.deleteUser=function(c,f,g,h){var i=($(c.currentTarget).parents("table").data("footable"),$(c.currentTarget).parents("tr:first"),{businessCustomerUid:f,businessUnitId:g});a.bdeViewOnly||($(c.currentTarget).closest("tr").addClass("current-selected"),b.post(h,i).success(function(a){if(a.openModal){$.magnificPopup.open({items:{src:"#deleteOrDeactivatePopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",closeMarkup:'<div class="mfp-close"><svg class="icon-cross"><use xlink:href="#icon-cross"></use></span></div>',callbacks:{close:function(){$(".current-selected").removeClass("current-selected")}}}),$("#deleteOrDeactivatePopup").find(".btn").attr("data-cuid",i.businessCustomerUid),$("#deleteOrDeactivatePopup").find(".btn").attr("data-buid",i.businessUnitId);$("#deleteOrDeactivatePopup").find(".btn-primary");$("#businessUnitDetailTagDeleteUser").attr("value",i.businessCustomerUid)}else d.setMessage(a.messageType,a.message),e()}).error(function(){$.magnificPopup.close(),$(".current-selected").removeClass("current-selected")}))},a.removeUser=function(a){var c={};c.businessCustomerUid=$("#deleteOrDeactivatePopup").find(".btn-primary").data("cuid"),b.post(a,c).success(function(a){d.setMessage(a.messageType,a.message),$(".current-selected").remove(),$.magnificPopup.close(),$("html,body").animate({scrollTop:0},"500")}).error(function(){})},a.editUserSubmit=function(e){var f=$("#sabmEditUserForm").attr("action");if(a.someSelected()||(e.$valid=!1),a.user.b2bUnitId=$(".b2bUnitId").val(),a.user.currentEmail=$(".currentEmail").val(),e.$valid){var g=(JSON.parse($("#customerData").text()),"/sabmStore/en/register/isExistingUser/"+e.email.$modelValue+"?createUser=false");a.user.active=!0,b.get(g).success(function(e){"TRUE"===e?$.magnificPopup.open({items:{src:"#forgotpwd-popup",type:"inline"},callbacks:{open:function(){$("#submit_button").on("click",function(){b.post(f,a.user).success(function(a){if("good"===a.messageType)return c.location.href=$(".baseUrl").val()+a.redirectUrl+"?message="+a.message+"&messageType="+a.messageType;d.setMessage(a.messageType,a.message),$("html,body").animate({scrollTop:0},"500")}).error(function(){})})}}}):b.post(f,a.user).success(function(a){if("good"===a.messageType)return c.location.href=$(".baseUrl").val()+a.redirectUrl+"?message="+a.message+"&messageType="+a.messageType;d.setMessage(a.messageType,a.message),$("html,body").animate({scrollTop:0},"500")}).error(function(){})}),a.notComplete=!1}else a.notComplete=!0},a.popDeleteUser=function(a){$("#deleteUserPopupCustomerUid").attr("value",$("#businessUnitDetailTagDeleteUser").attr("value")),$("#deleteUserPopupB2bUnitUid").attr("value",a),$.magnificPopup.open({items:{src:"#deleteUserPopup",type:"inline"},modal:!0,removalDelay:500,mainClass:"mfp-slide"})},$("#confirm-delete-user").on("click",function(){$("#deleteUserForm").submit()})}]),a.controller("updatePasswordCtrl",["$scope",function(a){a.init=function(){a.updatePassword.rules={characters:!1,numbers:!1,show:!1}},a.checkNewPassword=function(){var b=/[A-Za-z]\w{7,}/g,c=/[0-9]\w{0,}/g;console.log(a.updatePassword.rules.numbers),b.test(a.updatePassword.newPassword.$modelValue)?a.updatePassword.rules.characters=!0:a.updatePassword.rules.characters=!1,c.test(a.updatePassword.newPassword.$modelValue)?a.updatePassword.rules.numbers=!0:a.updatePassword.rules.numbers=!1}}]),a.controller("serviceCtrl",["$scope","$http","$window","angularUtils",function(e,$http,t,i){e.message="",e.messageType="",e.serviceRequestInit=function(){e.sr={},e.delIssueChecks=[],e.$watch("serviceRequest.$valid",function(a){var t=document.referrer;document.URL.indexOf("business")>=0&&t.indexOf("orderConfirmation")>=0&&(e.sr.type="pickup"),a?e.notComplete=!1:console.log("form not valid")})},e.checkValid=function(a,t){var $btn=$("#form-btn");$("#keg-issue-upload-failure").remove(),$btn.prop("disabled",true);t=e.sr.type;var i={};if((i=e.sr).request=e[t],!a.$valid?(e.notComplete=!0,$btn.prop("disabled",false),void 0):(e.notComplete=!1,!0)){var n="",r=i.bu,o="",s="";if(r){var l=r.split("--");o=l[0],s=l[1].replace(/^0+/,"")}i.phoneNumber&&(n=i.phoneNumber.toString());var c=e.sr.reasonCode,d={emailAddress:i.email||$("#asahiStaffEmail").val()||$("#liveChatCustomDetails").attr("data-email"),businessUnit:o,preferredContactMethod:i.prefcontact,requestType:i.type,name:i.name,phoneNumber:n,data:i.request};if("KEG_ISSUE"!=t)$http.post("/businessEnquiry/send",d).success(function(e,a){window.location=window.location.origin+"/businessEnquiry/enquirySent"}).error(function(e){$btn.prop("disabled",false);window.location=e.redirectUrl});else{var u=$("#Product_Name__code").val(),p="",m=$(".keg_bestbefore_avl:checked").val(),f=$("#keg_bestbefore_date").val();if(f="No"===m?"NA":f,u){var g=u.split("--");g[0],p=parseInt(g[1],10)}var b=d.name,h=d.preferredContactMethod,v=d.emailAddress,y=d.phoneNumber,D=$("#request_type").val(),E=$("#keg-number").val(),C=$("#keg-other").val(),P=$("#time-code").val(),T=$("#plant-code").val(),k=$("#liveChatCustomDetails").attr("data-userpk"),I=JSON.stringify({name:b,businessUnit:"CUB",preferredContactMethod:h,emailAddress:v,phoneNumber:y,requestType:"Keg Quality Complaint",data:{brand:s,number:E,bestBeforeDate:f,kegProblem:C,timecode:P,plantcode:T,sku:p,userPk:k,bestBeforeDateAvailable:m,reasonCode:c}});$.ajax({type:"POST",url:"/businessEnquiry/createKegIssue",data:I,contentType:"application/json",success:function(e){"success"==e.status&&(window.location=window.location.origin+"/businessEnquiry/enquirySent")},error:function(e){$btn.prop("disabled",false);0===$("#keg-issue-upload-failure").length&&$("#form-btn").after('\n                          <span class="error-bold" ng-show="notComplete" id="keg-issue-upload-failure">\n                          There was an error processing your request. Please try again.\n                          </span>\n                          '),$btn.prop("disabled", false),console.error("Error details:",e)}})}}},e.updateDelIssueChecks=function(a){i.arrayContains(e.delIssueChecks,a)?e.delIssueChecks.splice(e.delIssueChecks.indexOf(a),1):e.delIssueChecks.push(a)}}]),a.controller("dealsCtrl",["$element","$scope","$http","$sce","$window","$filter","angularUtils","orderByFilter",function(a,b,c,d,e,f,g,h){var k=JSON.parse($("#dealsData").html()),l=$(".delivery-header-input").attr("data-enabled-dates"),m=$(".delivery-header-input").attr("data-selected-timestamp");b.init=function(a){if(a){for(var c in k)k[c].brands=k[c].brands.sort();b.deals=h(k,[b.sortingBrands,b.sortingProductName,b.sortingQty])}else b.deals=k;b.dealsActivated=[],b.dealToggle=!0,b.pageInactive=!1,$(".bd-portal").length&&(b.userStatus=$("#dealPageWrapper").attr("data-status")),$(".view-only-mode").length&&(b.bdeViewOnly=!0)},b.filterInit=function(){b.enabledDates=JSON.parse(l),b.limitfilter={brands:5,categories:5,badges:5},b.showing={brands:!1,categories:!1,badges:!1},b.filterDate=m,b.listAllBrands(),b.listAllCategories(),b.listAllBadges(),b.hasBadges()},b.dealInit=function(a,c){a.dealToggle=c,a.multiplier=0,a.daysRemain=b.daysRemain(a);var d;if(a.dealImage="",a.dealImageTitle="",a.dealImageUrl="",1===a.ranges.length&&1===a.ranges[0].baseProducts.length&&0===a.selectableProducts.length)console.log("single"),a.single=!0,d=a.ranges[0].baseProducts[0];else{console.log("multi"),a.single=!1;var e=h(a.ranges,"title");d=h(e[0].baseProducts,"title")[0]}d&&(a.firstBaseProduct=d,d.image&&(a.dealImage=d.image,d.image.title&&(a.dealImageTitle=d.image.title)),a.dealImageUrl=d.url)},b.rangeInit=function(a,c){c.multiply=0,c.totalQty=b.calcTotalQty(a,c)},b.clearFilter=function(){b.brandsChecked=[],b.categoriesChecked=[],b.badgesChecked=[],b.calculateCategoriesMap(),b.calculateBadgesMap(),b.calculateBrandsMap(),$(".facet-check").each(function(){$(this).attr("checked",!1)})},b.getHtml=function(a){return d.trustAsHtml(a)},b.currentDate=function(){var a=new Date;return a.setHours(0),a.setMinutes(0),a.setSeconds(0),Date.parse(a)},b.togglePDPLimit={limit:3,open:!1},b.brandsMap={},b.categoriesMap={},b.brandsOnPage=[],b.brandsChecked=[],b.brandsFilters=[],b.categoriesOnPage=[],b.categoriesChecked=[],b.categoriesFilters=[],b.badgesOnPage=[],b.badgesChecked=[],b.sortingBrands=function(a){if(1===a.ranges.length)return a.brands[0];var b=a.ranges;return h(b,"title")[0].title},b.sortingProductName=function(a){if(1===a.ranges.length)return a.ranges[0].baseProducts[0].title;var b=a.ranges;return h(b,"title")[0].baseProducts[0].title},b.sortingQty=function(a){if(1===a.ranges.length)return a.ranges[0].minQty;var b=a.ranges;return h(b,"title")[0].minQty},b.brandSorting=function(a){return b.brandsMap[a]},b.categorySorting=function(a){return b.categoriesMap[a]},b.badgeSorting=function(a){return b.badgesMap[a]},b.addToCart=function(a,d){var e=$("#recommendation-addToOrder-"+a.code);if(0==e.length||!e.hasClass("disabled")){e.length>0&&e.addClass("disabled");var f={dealCode:a.code},g=[];a.dealToggle=!1;for(range in a.ranges)for(prod in a.ranges[range].baseProducts)if($(".cartRecommendations").length>0){var h={};h.productCodePost=a.ranges[range].baseProducts[prod].productCode,h.qty=a.ranges[range].baseProducts[prod].qty,g.push(h)}else if(a.ranges[range].baseProducts[prod].newQty>0){var h={};h.productCodePost=a.ranges[range].baseProducts[prod].productCode,h.qty=a.ranges[range].baseProducts[prod].newQty,g.push(h)}a.selectableProducts&&0!=a.selectableProducts.length&&(f.dealCode=a.selectedItem),f.baseProducts=g,b.dealCurrentUrl=$(".dealCurrentUrl").val(),c.post(b.dealCurrentUrl,f).success(function(b,c){var d=$("#simulationErrors");b.remainingValue?a.remainingValue=b.remainingValue:b.remainingQty&&(a.remainingQty=b.remainingQty),b.addToCartForErrorLayer&&d.html(b.addToCartForErrorLayer),ACC.product.displayAddToCartPopup(b);var e=$("#recommendation-addToOrder-"+a.code);e.length>0&&(rm.recommendation.updateRecommendation(e,"ACCEPTED"),$(".cartRecommendations").length>0&&($(".cartRow").length>0?rm.recommendation.resetCartForRecommendation(a,"deal"):rm.cart.refreshPage())),ACC.minicart.refreshMiniCartCount(),ACC.common.refreshScreenReaderBuffer()}).error(function(a,b){console.log("error")})}},b.addToRecommendation=function(a,d){var e={dealCode:a.code},f=$("#addRecommendation"+a.code),g=[];if(!$(f).hasClass("adding")){$(f).addClass("adding"),a.dealToggle=!1;for(range in a.ranges)for(prod in a.ranges[range].baseProducts){var h={};h.productCodePost=a.ranges[range].baseProducts[prod].productCode,h.qty=a.ranges[range].baseProducts[prod].newQty,h.unit=a.ranges[range].baseProducts[prod].uomCode,g.push(h)}a.selectableProducts&&0!=a.selectableProducts.length&&(e.dealCode=a.selectedItem),e.baseProducts=g,b.recommendationCurrentUrl=$(".recommendationCurrentUrl").val(),c.post(b.recommendationCurrentUrl,e).success(function(b,c){$(f).find("#recommendationStar").removeClass("icon-star-normal").addClass("icon-star-add"),$(f).find("#recommendationText").html($("#addedText").html()),setTimeout(function(){$(f).find("#recommendationStar").removeClass("icon-star-add").addClass("icon-star-normal"),$(f).find("#recommendationText").html($("#addText").html());for(range in a.ranges)for(prod in a.ranges[range].baseProducts)a.ranges[range].baseProducts[prod].newQty>0&&(a.ranges[range].baseProducts[prod].newQty=a.ranges[range].baseProducts[prod].qty,$("#qty-"+a.code+"-"+a.ranges[range].baseProducts[prod].productCode)[0].value=a.ranges[range].baseProducts[prod].qty);$(f).removeClass("adding")},5e3),rm.recommendation.displayAddToRecommendationPopup(b)}).error(function(a,b){console.log("error")})}},b.toggleThis=function(a,b){a.dealToggle=!a.dealToggle,$(b.currentTarget).hasClass("wasclicked")||($(b.currentTarget).addClass("wasclicked"),rm.tagManager.addProductImpressionListener())},b.collapsedAllFunc=function(){for(b.collapsedAll=!b.collapsedAll,i=0;i<b.deals.length;i++)b.deals[i].dealToggle=b.collapsedAll},b.limitdealsPDP=function(a){3==b.togglePDPLimit.limit?(b.togglePDPLimit.limit=a.length,b.togglePDPLimit.open=!0):(b.togglePDPLimit.limit=3,b.togglePDPLimit.open=!1)},b.brandFilterFilter=function(a){if(b.brandsMap[a])return!0;g.arrayContains(b.brandsChecked,a)&&b.brandsChecked.splice(b.brandsChecked.indexOf(a),1)},b.categoryFilterFilter=function(a){if(b.categoriesMap[a])return!0;g.arrayContains(b.categoriesChecked,a)&&b.categoriesChecked.splice(b.categoriesChecked.indexOf(a),1)},b.badgesFilterFilter=function(a){if(b.badgesMap[a])return!0;g.arrayContains(b.badgesChecked,a)&&b.badgesChecked.splice(b.badgesChecked.indexOf(a),1)},b.listAllBrands=function(){for(i=b.deals.length-1;i>=0;i--)for(j=0;j<b.deals[i].brands.length;j++)g.arrayContains(b.brandsOnPage,b.deals[i].brands[j])||b.brandsOnPage.push(b.deals[i].brands[j]);b.calculateBrandsMap()},b.listAllCategories=function(){for(i=0;i<b.deals.length;i++)if(null!==b.deals[i].categories&&void 0!==b.deals[i].categories)for(j=0;j<b.deals[i].categories.length;j++)g.arrayContains(b.categoriesOnPage,b.deals[i].categories[j])||b.categoriesOnPage.push(b.deals[i].categories[j]);b.calculateCategoriesMap()},b.listAllBadges=function(){for(i=0;i<b.deals.length;i++)if(null!==b.deals[i].badges&&void 0!==b.deals[i].badges)for(j=0;j<b.deals[i].badges.length;j++)g.arrayContains(b.badgesOnPage,b.deals[i].badges[j])||b.badgesOnPage.push(b.deals[i].badges[j]);b.calculateBadgesMap()},b.addRemoveBrands=function(a){g.arrayContains(b.brandsChecked,a)?b.brandsChecked.splice(b.brandsChecked.indexOf(a),1):b.brandsChecked.push(a),b.calculateCategoriesMap(),b.calculateBadgesMap()},b.addRemoveBadges=function(a){g.arrayContains(b.badgesChecked,a)?b.badgesChecked.splice(b.badgesChecked.indexOf(a),1):b.badgesChecked.push(a),b.calculateCategoriesMap(),b.calculateBrandsMap()},b.addRemoveCategories=function(a){g.arrayContains(b.categoriesChecked,a)?b.categoriesChecked.splice(b.categoriesChecked.indexOf(a),1):b.categoriesChecked.push(a),b.calculateBrandsMap(),b.calculateBadgesMap()},b.calculateCategoriesMap=function(){for(b.categoriesMap={},i=0;i<b.deals.length;i++)if(b.dealDatesFilter(b.deals[i])&&b.checkBadges(b.deals[i])&&b.checkBrands(b.deals[i])&&null!==b.deals[i].categories&&void 0!==b.deals[i].categories)for(z=0;z<b.deals[i].categories.length;z++)null!==b.categoriesMap[b.deals[i].categories[z]]&&void 0!==b.categoriesMap[b.deals[i].categories[z]]?b.categoriesMap[b.deals[i].categories[z]]=1+b.categoriesMap[b.deals[i].categories[z]]:b.categoriesMap[b.deals[i].categories[z]]=1},b.calculateBadgesMap=function(){for(b.badgesMap={},i=0;i<b.deals.length;i++)if(b.dealDatesFilter(b.deals[i])&&b.checkCategories(b.deals[i])&&b.checkBrands(b.deals[i])&&null!==b.deals[i].badges&&void 0!==b.deals[i].badges)for(z=0;z<b.deals[i].badges.length;z++)null!==b.badgesMap[b.deals[i].badges[z]]&&void 0!==b.badgesMap[b.deals[i].badges[z]]?b.badgesMap[b.deals[i].badges[z]]=1+b.badgesMap[b.deals[i].badges[z]]:b.badgesMap[b.deals[i].badges[z]]=1},b.calculateBrandsMap=function(){for(b.brandsMap={},i=0;i<b.deals.length;i++)if(b.dealDatesFilter(b.deals[i])&&b.checkBadges(b.deals[i])&&b.checkCategories(b.deals[i])&&null!==b.deals[i].brands&&void 0!==b.deals[i].brands)for(z=0;z<b.deals[i].brands.length;z++)null!==b.brandsMap[b.deals[i].brands[z]]&&void 0!==b.brandsMap[b.deals[i].brands[z]]?b.brandsMap[b.deals[i].brands[z]]=1+b.brandsMap[b.deals[i].brands[z]]:b.brandsMap[b.deals[i].brands[z]]=1},b.checkBadges=function(a){if(null===a.badges||void 0===a.badges)return 0===b.badgesChecked.length;for(j=0;j<a.badges.length;j++)if(g.arrayContains(b.badgesChecked,a.badges[j])||0===b.badgesChecked.length)return!0;return!1},b.checkBrands=function(a){if(null===a.brands||void 0===a.brands)return!0;for(j=0;j<a.brands.length;j++)if(g.arrayContains(b.brandsChecked,a.brands[j])||0===b.brandsChecked.length)return!0;return!1},b.checkCategories=function(a){if(null===a.categories||void 0===a.categories)return!0;for(j=0;j<a.categories.length;j++)if(g.arrayContains(b.categoriesChecked,a.categories[j])||0===b.categoriesChecked.length)return!0;return!1},b.hasBadges=function(){if(null!==b.badgesMap&&void 0!==b.badgesMap)for(console.log(b.badgesMap),i=0;i<8;i++)if(void 0!==b.badgesMap[i]&&7!==i)return!0;return!1},b.badges=function(a,b){return!!g.arrayContains(a.badges,b)},b.dealBrandsFilter=function(a){if(b.brandsChecked.length>0){for(i in b.brandsChecked)if(g.arrayContains(a.brands,b.brandsChecked[i]))return!0;return!1}return!0},b.dealCategoriesFilter=function(a){if(b.categoriesChecked.length>0){for(i in b.categoriesChecked)if(g.arrayContains(a.categories,b.categoriesChecked[i]))return!0;return!1}return!0},b.dealBadgesFilter=function(a){if(b.badgesChecked.length>0){for(i in b.badgesChecked)if(g.arrayContains(a.badges,b.badgesChecked[i]))return!0;return!1}return!0},b.dealDatesFilter=function(a){var c=parseInt(b.filterDate);return c>=a.validFrom&&c<=a.validTo},b.dealExpiredFilter=function(a){return parseInt(b.currentDate())<=a.validTo},b.formatDates=function(e){return e===parseInt(m)?f("date")(b.customDateFormatWithHyphen(e)+" (Current)"):f("date")(b.customDateFormatWithHyphen(e))},b.customDateFormatGeneric=function(e,t,n){var r=new Date(parseInt(e)).toLocaleString("en-AU",t);return n&&(r=r.replace(/\//g,"-")),r},b.customDateFormatWithHyphen=function(e){return b.customDateFormatGeneric(e,{timeZone:"Australia/Sydney",year:"numeric",month:"numeric",day:"numeric"},!0)},b.customDateFormatWithWeek=function(e){return b.customDateFormatGeneric(e,{weekday:"short",timeZone:"Australia/Sydney",year:"numeric",month:"numeric",day:"numeric"},!1)},b.deliveryDateChange=function(){var a=parseInt(b.filterDate);b.pageInactive=m!=a,b.calculateCategoriesMap(),b.calculateBrandsMap(),b.calculateBadgesMap()},b.calcTotalQty=function(a,b){var c=0;if(a.valid=!0,b)for(prod in b.baseProducts)b.baseProducts[prod].newQty?c+=parseInt(b.baseProducts[prod].newQty):""==b.baseProducts[prod].newQty?a.valid=!1:c+=parseInt(b.baseProducts[prod].qty);if((a.freeProducts||a.selectedProducts)&&0!=c&&0!=b.minQty){b.multiply=Math.floor(c/b.minQty);var d=[];for(r in a.ranges)void 0!=a.ranges[r].multiply&&d.push(a.ranges[r].multiply);a.multiplier=Math.min.apply(Math,d)}return c},b.calcInput=function(a,c,d){var e=d.qty;c.totalQty=b.calcTotalQty(a,c),setTimeout(function(){(d.newQty<e||""===d.newQty)&&(d.newQty=e,c.totalQty=b.calcTotalQty(a,c),b.$apply())},2e3)},b.rangeValid=function(a,b){return a.minQty>0&&a.minQty>a.totalQty?(a.rangeIsValid=!1,!1):(a.rangeIsValid=!0,!0)},b.dealValid=function(a){if(0==a.selectableProducts){for(i in a.ranges)if(!b.rangeValid(a.ranges[i],a))return!1;return!0}for(i in a.ranges)if(!b.rangeValid(a.ranges[i]))return!1;if(a.selectedItem)return!0},b.mapQty=function(a){var c=a.ranges[0].totalQty;if(a.freeProducts&&0!=a.freeProducts.length)for(prod in a.freeProducts){var d=Object.keys(a.freeProducts[prod].qty),e=d.sort(function(a,b){return a-b}),f=Math.min.apply(Math,d),g=a.freeProducts[prod].qty[f];if(!0===a.freeProducts[prod].proportionalFreeGood)g=b.dealValid(a)?a.freeProducts[prod].qty[f]*a.multiplier:a.freeProducts[prod].qty[f];else for(i=0;i<e.length;i++)c>=e[i]&&(g=a.freeProducts[prod].qty[e[i]])}if(a.selectableProducts&&0!=a.selectableProducts.length)for(prod in a.selectableProducts){var d=Object.keys(a.selectableProducts[prod].qty),e=d.sort(function(a,b){return a-b}),f=Math.min.apply(Math,d),g=a.selectableProducts[prod].qty[f];if(!0===a.selectableProducts[prod].proportionalFreeGood)g=a.ranges[0].totalQty<a.ranges[0].minQty?a.selectableProducts[prod].qty[f]:a.selectableProducts[prod].qty[f]*a.multiplier;else for(key in a.selectableProducts[prod].qty)c>=key&&(g=a.selectableProducts[prod].qty[key])}return g},b.daysRemain=function(a){var b=new Date,c=b.getTime(),d=a.validTo,e=Math.abs(d-c)/1e3;return Math.floor(e/86400)+1},b.checkActive=function(a){var c={status:a.active,dealConditionNumber:a.code};if(0!=b.dealsActivated.length){var d=-1;for(i in b.dealsActivated)if(b.dealsActivated[i].dealConditionNumber===c.dealConditionNumber){d=i;break}d>=0?b.dealsActivated.splice(d,1):b.dealsActivated.push(c)}else b.dealsActivated.push(c)},b.addChangesDeal=function(){var a={};a.uid=$("#uid").val(),b.specificDealCurrentUrl=$("#specificDealCurrentUrl").val(),b.specificDealNextUrl=$("#specificDealNextUrl").val(),a.conditions=b.dealsActivated,a.CSRFToken=ACC.config.CSRFToken,a.saveChanges=!1,c.post(b.specificDealCurrentUrl,a).success(function(a,c){if("1"===a.code)return e.location.href=b.specificDealNextUrl;console.log(a.message)}).error(function(a,b){console.log("error")})},b.confirmDealsChanges=function(){var a={};a.uid=$("#uid").val(),b.specificDealCurrentUrl=$("#specificDealCurrentUrl").val(),a.conditions=b.dealsActivated,a.CSRFToken=ACC.config.CSRFToken,a.saveChanges=!0,c.post(b.specificDealCurrentUrl,a).success(function(a,b){"1"===a.code?$("#confirmDealsChangesLink").click():console.log(a.message)}).error(function(a,b){console.log("error")})}}]),a.controller("cartCtrl",["$scope","$http","$sce","angularUtils","$timeout","globalMessageService",function(a,b,c,d,e,f){a.init=function(b){a.addresses=JSON.parse($("#addressData").html()),a.cartDealsData=JSON.parse($("#cartDealsData").html()),a.selectedFree={},a.selectedAddress=0,a.partialDeals=[],a.selectedDeal={selected:"deal_1"},a.partialPopup=!1,a.freePopup=!1,a.conflictPopup=!1,e(function(){if(!$.isEmptyObject(a.cartDealsData)&&(a.cartDealsData.conflict&&(a.dealsConflictData=a.cartDealsData.conflict,b&&a.dealsConflictData.length&&(a.conflictPopup=!0,a.selectedDeal={selected:a.cartDealsData.conflict[0].code},$.magnificPopup.open({items:{src:"#dealsConflictPopup",type:"inline"},modal:!0,removalDelay:500,mainClass:"mfp-slide",callbacks:{close:function(){"conflict"===a.orderSimulate&&rm.cart.getRecalculatedData()},open:function(){rm.tagManager.addDealsImpressionAndPosition("Viewed","ConflictDeal")}}}))),a.cartDealsData.free&&(a.dealsFreeData=a.cartDealsData.free,a.selectedFree={selected:a.cartDealsData.free.selected},b&&!$.isEmptyObject(a.dealsFreeData)&&(a.freePopup=!0,$.magnificPopup.open({items:{src:"#chooseFreePopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",modal:!0,callbacks:{close:function(){"free"===a.orderSimulate&&rm.cart.getRecalculatedData()}}}))),a.cartDealsData.partial)){a.partialQualDeals=a.cartDealsData.partial;var c=a.partialQualDeals.deals,d=a.partialQualDeals.conflicts;b&&(void 0!==c&&c.length>0||void 0!==d&&d.length>0)&&(a.partialPopup=!0,$.magnificPopup.open({items:{src:"#partiallyQualified",type:"inline"},modal:!0,removalDelay:500,mainClass:"mfp-slide",callbacks:{open:function(){rm.tagManager.addDealsImpressionAndPosition("Viewed","PartiallyQualifiedDeal")},close:function(){}}}))}b&&!1===a.partialPopup&&!1===a.freePopup&&!1===a.conflictPopup&&$("#cartCtrl").data("calculation")&&rm.cart.getRecalculatedData(),b&&a.popupOrderSimulate()},10)},a.dealInit=function(a){a.firstBaseProduct=a.ranges[0].baseProducts[0]},a.chooseFreeProduct=function(c){var d={dealCode:c};b.post("/sabmStore/en/cart/showOtherFreeGoods",d).success(function(b){a.dealsFreeData=b,a.selectedFree.selected=c,$.magnificPopup.open({items:{src:"#chooseFreePopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",modal:!0,callbacks:{close:function(){rm.cart.getRecalculatedData()}}})}).error(function(a,b){})},a.partialQualInit=function(){a.qualified=!1},a.getHtml=function(a){return c.trustAsHtml(a)},a.partialQualsValid=function(){var b=[];if(a.partialQualDeals&&!$.isEmptyObject(a.partialQualDeals)){for(deal in a.partialQualDeals.deals)if(a.partialQualDeals.deals[deal].selected){for(range in a.partialQualDeals.deals[deal].ranges){var c=a.partialQualDeals.deals[deal].ranges[range];if(c.totalQty=a.calcTotalQty(c),!a.rangeValid(c))return!1}b.push(a.partialQualDeals.deals[deal])}else dealsSelected=!0;for(conflict in a.partialQualDeals.conflicts)if(a.partialQualDeals.conflicts[conflict].active){for(range in a.partialQualDeals.conflicts[conflict].active.ranges){var c=a.partialQualDeals.conflicts[conflict].active.ranges[range];if(c.totalQty=a.calcTotalQty(c),!a.rangeValid(c))return!1}b.push(a.partialQualDeals.conflicts[conflict].active)}return 0!=b.length&&(a.partialDeals=b,!0)}},a.popupOrderSimulate=function(){!0===a.partialPopup?$("#partiallyQualified .btn-secondary").on("click",function(){rm.cart.getRecalculatedData()}):!1===a.freePopup?a.orderSimulate="conflict":a.orderSimulate="free"},a.rangeValid=function(a){return!(a.minQty>0&&a.minQty>a.totalQty)},a.calcTotalQty=function(a){var b=0;for(prod in a.baseProducts)a.baseProducts[prod].newQty?b+=parseInt(a.baseProducts[prod].newQty):b+=parseInt(a.baseProducts[prod].qty);return b},a.resizeDealsData={dealsCheckbox:function(a,b){if(a&&a.code){var c=JSON.parse($("#cartDealsData").html());if(!a.selected)for(var d=c.partial.deals,e=0;e<d.length;e++)a.code==d[e].code&&(a.ranges=d[e].ranges);var f="#"+b;$(f).hasClass("wasclicked")||($(f).addClass("wasclicked"),rm.tagManager.addProductImpressionListener())}},conflictRadio:function(a,b){if(a&&a.code){var c=JSON.parse($("#cartDealsData").html());if(!a.selected)for(var d=c.partial.conflicts,e=0;e<d.length;e++)for(var f=0;f<d[e].conflict.length;f++){var g=d[e].conflict[f];g&&a.code==g.code&&(a.ranges=g.ranges)}var h="#"+b;$(h).hasClass("wasclicked")||($(h).addClass("wasclicked"),rm.tagManager.addProductImpressionListener())}}},a.addFreeToCart=function(a){var c={dealCode:a};b.post("/cart/selectDealCart",c).then(function(a){$.magnificPopup.close()},function(a){$.magnificPopup.close()})},a.addPartialQualToCart=function(){var c=[];for(obj in a.partialDeals){var d={},e=[];d.dealCode=a.partialDeals[obj].code;for(range in a.partialDeals[obj].ranges)for(prod in a.partialDeals[obj].ranges[range].baseProducts)if(a.partialDeals[obj].ranges[range].baseProducts[prod].newQty>0){var f={};f.productCodePost=a.partialDeals[obj].ranges[range].baseProducts[prod].productCode,f.qty=a.partialDeals[obj].ranges[range].baseProducts[prod].newQty,e.push(f)}d.baseProducts=e,c.push(d)}$.magnificPopup.close(),b.post("/cart/add/partialdeal",c).success(function(b,d){ACC.product.displayAddToCartPopup(b),ACC.minicart.refreshMiniCartCount(),ACC.common.refreshScreenReaderBuffer(),rm.cart.getRecalculatedData(),a.cleanPQDarray(c)}).error(function(a,b){})},a.cleanPQDarray=function(b){for(deal in b){for(pqd in a.partialQualDeals.deals)b[deal].dealCode===a.partialQualDeals.deals[pqd].code&&a.partialQualDeals.deals.splice(pqd,1);for(conflicts in a.partialQualDeals.conflicts)for(conflict in a.partialQualDeals.conflicts[conflicts])if(b[deal].dealCode===a.partialQualDeals.conflicts[conflicts][conflict].code){a.partialQualDeals.conflicts.splice(conflicts,1);break}}},a.selectAddress=function(b){a.selectedAddress=b,a.addresses[b].defaultAddress?a.setDeliveryAddress(!1):a.addresses[b].defaultB2BunitAddress?a.setDeliveryAddress(!1):$.magnificPopup.open({items:{src:"#saveAsDefault",type:"inline"},modal:!0,removalDelay:500,mainClass:"mfp-slide"})},a.setDeliveryAddress=function(c){var d={addressId:a.addresses[a.selectedAddress].id,defaultAddress:c};$(".loading-message").length>0&&rm.utilities.loadingMessage($(".loading-message").data("login")||"",!0),$("body").addClass("loading"),b.post($("#updateSABMdeliveryAddressUrl").val(),d).success(function(b,c){$(".selected-delivery-address").html($(".selected-delivery-address",b).html()),$("#globalMessage").html($("#simulationErrors",b).html()),a.addresses=JSON.parse($("#addressData",b).html()),window.location.reload(),rm.utilities.goBackTop(),rm.cart.showRecalculate()}).error(function(a,b){}),$.magnificPopup.close()}}]),a.controller("contactUsCtrl",["$scope","$http","$window","angularUtils",function(a,b,c,d){a.contactUsInit=function(){a.sr={},a.delIssueChecks=[],a.$watch("serviceRequest.$valid",function(b){b?a.notComplete=!1:console.log("form not valid")})},a.checkValid=function(b){b.$valid?(a.notComplete=!1,$("#serviceRequestForm").submit()):a.notComplete=!0},a.updateDelIssueChecks=function(b){d.arrayContains(a.delIssueChecks,b)?a.delIssueChecks.splice(a.delIssueChecks.indexOf(b),1):a.delIssueChecks.push(b)}}]),a.controller("registrationRequestCtrl",["$scope","$http","$window","angularUtils",function(a,b,c,d){a.registrationRequestInit=function(){a.rr={},a.accoutTypeError=!1,a.accessTypeError=!1,a.formHaveError=!1,a.termsofuseError=!1,a.firstNameError=!1,a.lastNameError=!1,a.emailError=!1,a.accountNameError=!1,a.workPhoneNumError=!1,a.$watch("registrationRequest.$valid",function(b){b?a.notComplete=!1:console.log("form not valid")})},a.checkValid=function(d){var e={};if(e=a.rr,d.$valid?a.notComplete=!1:(void 0===e.firstName?a.firstNameError=!0:a.firstNameError=!1,a.notComplete=!0),a.updateCheckBoxChecks(d,"accoutType"),a.updateCheckBoxChecks(d,"accessType"),a.updateCheckBoxChecks(d,"termsofuse"),a.updateInputFields(d,"firstName"),a.updateInputFields(d,"lastName"),a.updateInputFields(d,"email"),a.updateInputFields(d,"accountName"),a.updateInputFields(d,"workPhoneNum"),a.accoutTypeError||a.accessTypeError||a.termsofuseError?a.notComplete=!0:a.notComplete=!1,!a.notComplete){var f="",g="";e.workPhoneNum&&(f=e.workPhoneNum.toString()),e.mobilePhoneNum&&(g=e.mobilePhoneNum.toString());var h=[];e.accoutType1&&(h[h.length]=$("#rr-accoutType1").val()),e.accoutType2&&(h[h.length]=$("#rr-accoutType2").val()),e.accoutType3&&(h[h.length]=$("#rr-accoutType3").val()),e.accoutType4&&(h[h.length]=$("#rr-accoutType4").val());var i=[];e.accessType1&&(i[i.length]=$("#rr-accessType1").val()),e.accessType2&&(i[i.length]=$("#rr-accessType2").val()),e.accessType3&&(i[i.length]=$("#rr-accessType3").val()),e.accessType4&&(i[i.length]=$("#rr-accessType4").val()),d.$valid&&$.magnificPopup.open({items:{src:"#forgotpwd-popup",type:"inline"},callbacks:{open:function(){$("#submit_button").click(function(d){var j={firstName:e.firstName,lastName:e.lastName,email:e.email,cubAccount:e.cubAccount,accountName:e.accountName,workPhoneNum:f,mobilePhoneNum:g,accoutType:h,accessType:i,haveMoreAccount:e.haveMoreAccount};$("body").addClass("loading"),b.post("/register/registration-form",j).success(function(b){"OK"==b?(a.formHaveError=!1,c.location="/register/registration-form?submitted=true"):(a.formHaveError=!0,console.log("failure")),$("body").removeClass("loading")}).error(function(a){$("body").removeClass("loading"),console.log("failure")})})}}})}},a.updateInputFields=function(b,c){var d={};d=a.rr,"firstName"==c&&(void 0===d.firstName?a.firstNameError=!0:a.firstNameError=!1),"lastName"==c&&(void 0===d.lastName?a.lastNameError=!0:a.lastNameError=!1),"email"==c&&(void 0===d.email?a.emailError=!0:a.emailError=!1),"accountName"==c&&(void 0===d.accountName?a.accountNameError=!0:a.accountNameError=!1),"workPhoneNum"==c&&(void 0===d.workPhoneNum?a.workPhoneNumError=!0:a.workPhoneNumError=!1)},a.updateCheckBoxChecks=function(b,c){var d={};d=a.rr,"accoutType"==c?d.accoutType1||d.accoutType2||d.accoutType3||d.accoutType4?a.accoutTypeError=!1:a.accoutTypeError=!0:"accessType"==c?d.accessType1||d.accessType2||d.accessType3||d.accessType4?a.accessTypeError=!1:a.accessTypeError=!0:"termsofuse"==c&&(d.termsofuse1?a.termsofuseError=!1:a.termsofuseError=!0)}}]),a.controller("notificationsCtrl",["$location","$scope","$http","$sce","$window","angularUtils","globalMessageService",function(a,b,c,d,e,f,g,h){b.init=function(){b.showMessageAfterPageLoad=sessionStorage.getItem("showMessageAfterPageLoad"),"true"===b.showMessageAfterPageLoad?($("#successSavingNotifications .successSavingNotifications").show(),sessionStorage.setItem("showMessageAfterPageLoad",!1)):$("#successSavingNotifications .successSavingNotifications").hide(),b.isTrackDeliveryOrderFeatureEnabled=$("#isTrackDeliveryOrderFeatureEnabled").val(),b.isInvoiceDiscrepancyEnabled=$("#isInvoiceDiscrepancyEnabled").val(),$("#mobileNumberShowError").hide(),$("#mobileNumberInput").hide(),b.learnMore=!1,b.notificationFormValid=!1,b.data=JSON.parse($("#notificationData").html()),b.mobileNumber=b.data.mobileNumber,b.orders=b.data.notificationPrefMap.ORDER,b.delivery=b.data.notificationPrefMap.DELIVERY,b.deals=b.data.notificationPrefMap.DEAL,b.isTrackDeliveryOrderFeatureEnabled&&(b.intransit=b.data.notificationPrefMap.INTRANSIT,b.nextInQueue=b.data.notificationPrefMap.NEXT_IN_QUEUE,b.updateForETA=b.data.notificationPrefMap.UPDATE_FOR_ETA,b.delivered=b.data.notificationPrefMap.DELIVERED),b.isInvoiceDiscrepancyEnabled&&(b.creditprocessed=b.data.notificationPrefMap.CREDITPROCESSED),b.showUnsavedChangesPopup(),b.showMobileNumberToggle=function(){void 0==b.mobileNumber||""==b.mobileNumber?($("#showMobileNumberLink").hide(),$("#showMobileNumberField").show()):($("#showMobileNumberLink").show(),$("#showMobileNumberField").hide())},b.showMobileNumberToggle()},b.resetNotifications=function(){b.orders.notificationTypeEnabled=!1,b.deals.notificationTypeEnabled=!1,b.delivery.notificationTypeEnabled=!1,b.intransit.notificationTypeEnabled=!1,b.nextInQueue.notificationTypeEnabled=!1,b.updateForETA.notificationTypeEnabled=!1,b.delivered.notificationTypeEnabled=!1,b.creditprocessed.notificationTypeEnabled=!1,b.orders.duration="15-minutes",b.orders.emailEnabled=!1,b.orders.smsEnabled=!1,b.deals.duration="Monday",b.deals.emailEnabled=!1,b.delivery.emailEnabled=!1,b.delivery.smsEnabled=!1,b.intransit.emailEnabled=!1,b.intransit.smsEnabled=!1,b.nextInQueue.emailEnabled=!1,b.nextInQueue.smsEnabled=!1,b.updateForETA.emailEnabled=!1,b.updateForETA.smsEnabled=!1,b.delivered.emailEnabled=!1,b.delivered.smsEnabled=!1,b.creditprocessed.emailEnabled=!1,b.creditprocessed.smsEnabled=!1,b.notificationFormValid=!0},b.invokePopup=function(a){console.log()},b.getDurationTimeUnit=function(a){return a.split("-")[1]},b.getDropDownLabel=function(a){return a.replace("-"," ")},b.orderFormData=function(){return{notificationType:"ORDER",notificationEnabled:$('input[id="orders.notificationEnabled"]').val(),emailEnabled:b.orders.emailEnabled,smsEnabled:b.orders.smsEnabled,emailDuration:b.orders.duration,smsDuration:b.orders.duration,smsDurationTimeUnit:b.getDurationTimeUnit(b.orders.duration)}},b.dealsFormData=function(){return{notificationType:"DEAL",notificationEnabled:$('input[id="deals.notificationEnabled"]').val(),emailEnabled:b.deals.emailEnabled,emailDuration:b.deals.duration,smsEnabled:b.deals.smsEnabled,smsDuration:b.deals.duration}},b.deliveryFormData=function(){return{notificationType:"DELIVERY",notificationEnabled:$('input[id="delivery.notificationEnabled"]').val(),emailEnabled:b.delivery.emailEnabled,smsEnabled:b.delivery.smsEnabled,emailDuration:"",smsDuration:""}},b.intransitFormData=function(){return{notificationType:"INTRANSIT",notificationEnabled:$('input[id="intransit.notificationEnabled"]').val(),emailEnabled:b.intransit.emailEnabled,emailDuration:b.intransit.duration,smsEnabled:b.intransit.smsEnabled,smsDuration:b.intransit.duration}},b.nextInQueueFormData=function(){return{notificationType:"NEXT_IN_QUEUE",notificationEnabled:$('input[id="nextInQueue.notificationEnabled"]').val(),emailEnabled:b.nextInQueue.emailEnabled,emailDuration:b.nextInQueue.duration,smsEnabled:b.nextInQueue.smsEnabled,smsDuration:b.nextInQueue.duration}},b.updateForETAFormData=function(){return{notificationType:"UPDATE_FOR_ETA",notificationEnabled:$('input[id="updateForETA.notificationEnabled"]').val(),emailEnabled:b.updateForETA.emailEnabled,emailDuration:b.updateForETA.duration,smsEnabled:b.updateForETA.smsEnabled,smsDuration:b.updateForETA.duration}},b.deliveredFormData=function(){return{notificationType:"DELIVERED",notificationEnabled:$('input[id="delivered.notificationEnabled"]').val(),emailEnabled:b.delivered.emailEnabled,emailDuration:b.delivered.duration,smsEnabled:b.delivered.smsEnabled,smsDuration:b.delivered.duration}},b.creditProcessedFormData=function(){return{notificationType:"CREDITPROCESSED",notificationEnabled:$('input[id="creditprocessed.notificationEnabled"]').val(),emailEnabled:b.creditprocessed.emailEnabled,emailDuration:b.creditprocessed.duration,smsEnabled:b.creditprocessed.smsEnabled,smsDuration:b.creditprocessed.duration}},b.checkifFormisUpdated=function(){if(angular.isUndefined(b.originalData)&&(b.originalData=JSON.parse($("#notificationData").html())),angular.isUndefined(b.originalData.mobileNumber)&&(b.originalData.mobileNumber=""),b.mobileNumber!=b.originalData.mobileNumber)return!0;if((b.orders.emailEnabled!=b.originalData.notificationPrefMap.ORDER.emailEnabled||b.orders.smsEnabled!=b.originalData.notificationPrefMap.ORDER.smsEnabled||b.orders.duration!=b.originalData.notificationPrefMap.ORDER.duration)&&void 0!=b.originalData.notificationPrefMap.ORDER)return!0;if(b.deals.emailEnabled!=b.originalData.notificationPrefMap.DEAL.emailEnabled||b.deals.duration!=b.originalData.notificationPrefMap.DEAL.duration)return!0;if((b.delivery.emailEnabled!=b.originalData.notificationPrefMap.DELIVERY.emailEnabled||b.delivery.smsEnabled!=b.originalData.notificationPrefMap.DELIVERY.smsEnabled)&&void 0!=b.originalData.notificationPrefMap.DELIVERY)return!0;if(b.isTrackDeliveryOrderFeatureEnabled){if((b.delivered.emailEnabled!=b.originalData.notificationPrefMap.DELIVERED.emailEnabled||b.delivered.smsEnabled!=b.originalData.notificationPrefMap.DELIVERED.smsEnabled)&&void 0!=b.originalData.notificationPrefMap.DELIVERED)return!0;if((b.intransit.emailEnabled!=b.originalData.notificationPrefMap.INTRANSIT.emailEnabled||b.intransit.smsEnabled!=b.originalData.notificationPrefMap.INTRANSIT.smsEnabled)&&void 0!=b.originalData.notificationPrefMap.INTRANSIT)return!0;if((b.nextInQueue.emailEnabled!=b.originalData.notificationPrefMap.NEXT_IN_QUEUE.emailEnabled||b.nextInQueue.smsEnabled!=b.originalData.notificationPrefMap.NEXT_IN_QUEUE.smsEnabled)&&void 0!=b.originalData.notificationPrefMap.NEXT_IN_QUEUE)return!0;if((b.updateForETA.emailEnabled!=b.originalData.notificationPrefMap.UPDATE_FOR_ETA.emailEnabled||b.updateForETA.smsEnabled!=b.originalData.notificationPrefMap.UPDATE_FOR_ETA.smsEnabled)&&void 0!=b.originalData.notificationPrefMap.UPDATE_FOR_ETA)return!0}return!(!b.isInvoiceDiscrepancyEnabled||b.creditprocessed.emailEnabled==b.originalData.notificationPrefMap.CREDITPROCESSED.emailEnabled&&b.creditprocessed.smsEnabled==b.originalData.notificationPrefMap.CREDITPROCESSED.smsEnabled||void 0==b.originalData.notificationPrefMap.CREDITPROCESSED)},b.invokeUnsavedChangesPopup=function(){b.checkifFormisUpdated()?($("body").addClass("unsaved-changes"),b.notificationFormValid=!0):($("body").removeClass("unsaved-changes"),b.notificationFormValid=!1)},b.switchOffUnsavedChangesPopup=function(){b.allowRedirect&&($("body").removeClass("unsaved-changes"),b.notificationFormValid=!1)},b.showUnsavedChangesPopup=function(){$("a, .highlight-link").on("click",function(a){b.checkifFormisUpdated()&&$("body.unsaved-changes").length&&(console.log("has unsaved changes"),b.destinationURL=document.activeElement.href,void 0==b.destinationURL&&void 0!=$(this).attr("data-url")&&(b.destinationURL=$(this).attr("data-url")),a.preventDefault(),$("#unsavedNotification").modal("show"))})},b.submitFromPopup=function(){b.submit(),void 0!=b.destinationURL&&b.allowRedirect&&(e.location.href=b.destinationURL)},b.submit=function(){b.notificationFormValid=!1,b.forms=[];var a={},c={};if(b.postDatas=function(){a={forms:b.forms},""!=b.mobileNumber&&(c={mobileNumber:b.mobileNumber});var d=$.extend({},c,a);$.ajax({url:"/sabmStore/en/your-notifications/save",type:"POST",dataType:"json",data:JSON.stringify(d),contentType:"application/json",success:function(a){a?(sessionStorage.setItem("showMessageAfterPageLoad",!0),$("#mobileNumberInput").hide(),e.scrollTo(0,0),window.location.reload()):($("#successSavingNotifications .successSavingNotifications").hide(),$("#mobileNumberInput").show(),window.scrollTo(0,0))},error:function(a){$("#successSavingNotifications .successSavingNotifications").hide()}})},angular.isUndefined(b.originalData)&&(b.originalData=JSON.parse($("#notificationData").html())),b.checkboxesValidation=function(){b.deals.emailEnabled==b.originalData.notificationPrefMap.DEAL.emailEnabled&&b.deals.duration==b.originalData.notificationPrefMap.DEAL.duration||void 0==b.originalData.notificationPrefMap.DEAL||b.forms.push(b.dealsFormData()),b.orders.emailEnabled==b.originalData.notificationPrefMap.ORDER.emailEnabled&&b.orders.duration==b.originalData.notificationPrefMap.ORDER.duration&&b.orders.smsEnabled==b.originalData.notificationPrefMap.ORDER.smsEnabled||void 0==b.originalData.notificationPrefMap.ORDER||b.forms.push(b.orderFormData()),b.delivery.emailEnabled==b.originalData.notificationPrefMap.DELIVERY.emailEnabled&&b.delivery.smsEnabled==b.originalData.notificationPrefMap.DELIVERY.smsEnabled||void 0==b.originalData.notificationPrefMap.DELIVERY||b.forms.push(b.deliveryFormData()),b.intransit.emailEnabled==b.originalData.notificationPrefMap.INTRANSIT.emailEnabled&&b.intransit.smsEnabled==b.originalData.notificationPrefMap.INTRANSIT.smsEnabled||void 0==b.originalData.notificationPrefMap.INTRANSIT||b.forms.push(b.intransitFormData()),b.nextInQueue.emailEnabled==b.originalData.notificationPrefMap.NEXT_IN_QUEUE.emailEnabled&&b.nextInQueue.smsEnabled==b.originalData.notificationPrefMap.NEXT_IN_QUEUE.smsEnabled||void 0==b.originalData.notificationPrefMap.NEXT_IN_QUEUE||b.forms.push(b.nextInQueueFormData()),b.updateForETA.emailEnabled==b.originalData.notificationPrefMap.UPDATE_FOR_ETA.emailEnabled&&b.updateForETA.smsEnabled==b.originalData.notificationPrefMap.UPDATE_FOR_ETA.smsEnabled||void 0==b.originalData.notificationPrefMap.UPDATE_FOR_ETA||b.forms.push(b.updateForETAFormData()),b.delivered.emailEnabled==b.originalData.notificationPrefMap.DELIVERED.emailEnabled&&b.delivered.smsEnabled==b.originalData.notificationPrefMap.DELIVERED.smsEnabled||void 0==b.originalData.notificationPrefMap.DELIVERED||b.forms.push(b.deliveredFormData()),b.creditprocessed.emailEnabled==b.originalData.notificationPrefMap.CREDITPROCESSED.emailEnabled&&b.creditprocessed.smsEnabled==b.originalData.notificationPrefMap.CREDITPROCESSED.smsEnabled||void 0==b.originalData.notificationPrefMap.CREDITPROCESSED||b.forms.push(b.creditProcessedFormData()),b.postDatas()},void 0!=b.mobileNumber&&0!==b.mobileNumber.length)if(b.mobileNumber!=b.originalData.mobileNumber)if(b.mobileNumber.charAt(0)+b.mobileNumber.charAt(1)!="04"||b.mobileNumber.length<12)$("#mobileNumberShowError").show(),$("#successSavingNotifications .successSavingNotifications").hide(),window.scrollTo(0,0),b.allowRedirect=!1;else{$("#mobileNumberShowError").hide(),b.showMobileNumberToggle(),b.allowRedirect=!0;var d=b.mobileNumber.split("");d=d.join("$").replace(/ /g,"").split("$"),c={mobileNumber:d.join("")},b.checkboxesValidation()}else $("#mobileNumberShowError").hide(),b.checkboxesValidation(),b.allowRedirect=!0;else $("#mobileNumberShowError").hide(),b.checkboxesValidation(),b.allowRedirect=!0},$("#mobileNumberField").keydown(function(a){var b=a.which||a.charCode||a.keyCode||0;return $phone=$(this),8!==b&&9!==b&&(4===$phone.val().length&&$phone.val($phone.val()+" "),8===$phone.val().length&&$phone.val($phone.val()+" ")),8==b||9==b||46==b||b>=48&&b<=57||b>=96&&b<=105}).bind("focus click",function(){if($phone=$(this),0===$phone.val().length)$phone.val("04");else{var a=$phone.val();$phone.val("").val(a)}}).blur(function(){$phone=$(this),"04"===$phone.val()&&$phone.val("")})}]),a.controller("smartOrdersCtrl",["$scope","$http","$sce","angularUtils","orderByFilter",function(a,b,c,d,e){a.init=function(){a.orders=JSON.parse($("#smartOrdersData").html()),a.assignNewQty(),a.createHtml(),$(".view-only-mode").length&&(a.bdeViewOnly=!0)},a.assignNewQty=function(){for(var b=0;b<a.orders.products.length;b++)a.orders.products[b].newQty=a.orders.products[b].qty},a.createHtml=function(){a.deal=[],dealTitle=$("#dealTitle").html();for(var b=0;b<a.orders.products.length;b++)if(a.deal[b]="",null!=a.orders.products[b].dealsTitle)for(var c=0;c<a.orders.products[b].dealsTitle.length;c++)a.deal[b]+="<p><span class='deal-title'>"+dealTitle+": </span>"+a.orders.products[b].dealsTitle[c]+"</p>"},a.enteredQty=function(b,c){a.orders.products[c].newQty=b.target.value},a.setDisable=function(b){a.orders.products[b].isDisabled=!0},a.addToCart=function(a){var c=[{productCodePost:a.code,qty:a.newQty,unit:a.newUnit}];b.post("/sabmStore/en/cart/add/smartOrder",c).success(function(a){ACC.product.displayAddToCartPopup(a),ACC.minicart.refreshMiniCartCount(),ACC.common.refreshScreenReaderBuffer()}).error(function(){console.log("failure")})},a.checkAndAddAllToCart=function(){return"true"==$("#changeDeliveryDatePresent").val()?($("#outOfStockPopup h2").empty().append(ACC.deliveryPackDate),void $("#outOfStockPopup").modal()):"true"==$("#outOfStockProductsPresent").val()?($("#outOfStockPopup h2").empty().append(ACC.outOfStock),void $("#outOfStockPopup").modal()):void a.addAllToCart()},a.addAllToCart=function(){var c=[],d="/sabmStore/en/cart/add/smartOrder";for(prod in a.orders.products)if(!(null!=a.orders.products[prod].cubStockStatus&&"outOfStock"==a.orders.products[prod].cubStockStatus.code||null!=a.orders.products[prod].isDisabled&&1==a.orders.products[prod].isDisabled)){var e={productCodePost:a.orders.products[prod].code,qty:a.orders.products[prod].newQty,unit:a.orders.products[prod].newUnit};c.push(e)}b.post(d,c).success(function(a){ACC.product.displayAddToCartPopup(a),ACC.minicart.refreshMiniCartCount(),ACC.common.refreshScreenReaderBuffer()}).error(function(){console.log("failure")})},a.yearAgo=function(){var b=new Date,c=b.getFullYear()-1,d=b.getMonth(),e=b.getDate(),f=new Date(c,d,e);2===d&&29===e&&(f=new Date(c,d,e-1)),a.orders.seeThisTimeLastYearLink&&$("#smart-date").datepicker("setDate",f)},a.getData=function(c,d){var e;if("specific"==d)console.log("specific"),e="/smartOrdersAjax?date="+c+"&sort=d";else if("prev"==d){if(!a.orders.previousOrdersLink)return;e="/smartOrdersAjax?date="+c+"&sort=p"}else if("next"==d){if(!a.orders.nextOrdersLink)return;e="/smartOrdersAjax?date="+c+"&sort=n"}b.get(e).success(function(b){a.orders=b,a.assignNewQty()}).error(function(){console.log("failure")})},a.unitChange=function(b,c,d){console.log(d),a.orders.products[c].newUnit=d,console.log(a.orders.products)},a.sortSmartOrders=function(b){a.productsList=a.orders.products,(angular.isDefined(b)||angular.isDefined(a.selected))&&(a.reverse=!0,a.sortBy=b||a.selected,"brand"===a.sortBy&&(a.reverse=!1),a.sortProducts=e(a.productsList,a.sortBy,a.reverse),a.orders.products=a.sortProducts)}}]),a.controller("messagesCtrl",["$scope","$http","globalMessageService",function(a,b,c){a.$watch(function(){return c.watch()},function(b,d){void 0!==d&&(a.message=c.getMessage(),a.messageType=c.getMessageType())},!0)}]),angular.module("breakpointApp",[]).directive("breakpoint",["$window","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){function f(a){b.$broadcast("breakpointChange",c.breakpoint,a)}function g(){c.breakpoint.windowSize=a.innerWidth,c.$$phase||c.$apply()}function h(a){var b=i[Object.keys(i)[0]];for(var e in i)e<a&&(b=i[e]),d.removeClass(i[e]);d.addClass(b),c.breakpoint.class=b,c.$$phase||c.$apply()}c.breakpoint={class:"",windowSize:a.innerWidth};var i=c.$eval(e.breakpoint);angular.element(a).bind("resize",g),c.$watch("breakpoint.windowSize",function(a,b){h(a)}),c.$watch("breakpoint.class",function(a,b){a!=b&&f(b)})}}}]),a.controller("PDPCtrl",["$scope","$http","$sce","angularUtils","globalMessageService",function(a,b,c,d,e,f){a.$on("breakpointChange",function(a,b,c){console.log("Entering:"+b.class),console.log("Leaving:"+c),console.log("windowSize"+b.windowSize)}),a.init=function(){console.log("here")},a.initSlider=function(b,c){$('h3[id="'+c+'"]');if("otherPack"===b){$("#tab-anchor");a.breakpoint.windowSize<990?a.slideOtherPack=!a.slideOtherPack:a.tab=2,setTimeout(function(){$(".other-packages .slick-slider").length&&$(".other-packages .slick-slider").get(0).slick.setPosition()},10)}else"related"===b&&(a.breakpoint.windowSize<990?a.slideRelated=!a.slideRelated:a.tab=4,setTimeout(function(){$(".related-products .slick-slider").length&&$(".related-products .slick-slider").get(0).slick.setPosition()},10))},a.accordionClick=function(b,c){$('h3[id="'+b+'"]');a[c]=!a[c]},a.changeTab=function(b){$("#tab-anchor");a.tab=b},a.trackPDPOtherPackOptions=function(a){void 0!==rm.tagManager.trackPDPOtherPackOptions&&rm.tagManager.trackPDPOtherPackOptions()},a.trackPDPPackConfiguration=function(a){void 0!==rm.tagManager.trackPDPPackConfiguration&&rm.tagManager.trackPDPPackConfiguration()}}]),a.controller("personalAssistanceCtrl",["$scope","$http","$window","angularUtils",function(a,b,c,d){a.checkSelected=function(){},a.clearForm=function(){for(var a=$("#paSearchForm input"),b=0;b<a.length;b++)"text"==a[b].type&&(console.log(a[b].type),a[b].value="")},a.checkValid=function(b){a.submitted=!0,b.$valid?$("#paSearchForm").submit():(console.log("not valid"),a.notComplete=!0)},a.updateDelIssueChecks=function(b){d.arrayContains(a.delIssueChecks,b)?a.delIssueChecks.splice(a.delIssueChecks.indexOf(b),1):a.delIssueChecks.push(b)}}]),a.controller("rewardsCtrl",["$scope",function(a){a.init=function(){a.b2bUnits=JSON.parse($("#b2bUnits").html()),a.user=JSON.parse($("#user").html()),a.selectedUsersQty=1,a.pointsAllToOneVenue="false",a.userCanAccessRewards=!1,a.contactMobile=a.user.mobileNumber,a.contactLandline=a.user.businessContactNumber,a.pointAccrual(),a.userSelect(),a.venueCount()},a.pointAccrual=function(){angular.forEach(a.b2bUnits,function(b){b.rewardAllToOneVenue&&(a.pointsAllToOneVenue="true",a.b2bUnitForPointsAllToOneVenue=b.name,a.b2bUnitForPointsAllToOneVenueId=b.uid)})},a.userSelect=function(){a.selectedUsers=[],angular.forEach(a.b2bUnits,function(b){angular.forEach(b.customers,function(c){c.canAccessRewards&&a.selectedUsers.push(c.uid+"|"+b.uid)})}),a.selectedUsersQty=a.selectedUsers.length+1,a.selectedUsers=a.selectedUsers.toString()},a.venueCount=function(){$.isEmptyObject(a.b2bUnits)||a.b2bUnits.length<=1?a.venueSingle=!0:a.venueMultiple=!0},a.venueSearch=function(){a.allVenues=[],angular.forEach(a.b2bUnits,function(b){a.allVenues.push({value:b.name,uid:b.uid})}),$("#venue-search").on("tokenfield:edittoken",function(a){a.preventDefault()}).on("tokenfield:removedtoken",function(a){$("#b2bUnitForPointsAllToOneVenue").val("")}).tokenfield({autocomplete:{appendTo:".search.venues",source:a.allVenues,select:function(a,b){$("#b2bUnitForPointsAllToOneVenue").val(b.item.uid)}},limit:1,showAutocompleteOnFocus:!0})}}]),a.controller("faqCtrl",["$scope","$http","$log",function(a,b,c){a.init=function(){a.faqData=JSON.parse($("#faqData").html()),a.filterCategories={},a.showAllQuestions(),a.faqRequest={},a.$watch("faqSendQuestion",function(){a.faqRequest.request=a.faqSendQuestion.faqQuestion,a.faqRequest.prefcontact="Email",a.faqRequest.type="faqs"}),a.faqSent=!1,a.faqSentSuccess=!1,a.faqSentError=!1,a.faqPagination()},a.hideExpanded=function(){$(".collapse").collapse("hide")},a.sendFaq=function(c){var d={};d=a.faqRequest;var e={businessUnit:d.businessUnit,data:d.request,emailAddress:d.email,name:d.name,preferredContactMethod:d.prefcontact,requestType:d.type};b.post("/sabmStore/en/businessEnquiry/send",e).success(function(b,c){a.faqSent=!0,a.faqSentSuccess=!0,setTimeout(function(){$(".alert").alert("close"),a.faqSentSuccess=!1},4e3),$.magnificPopup.close()}).error(function(b){a.faqSent=!0,a.faqSentError=!0,setTimeout(function(){$(".alert").alert("close"),a.faqSentError=!1},1e4),$.magnificPopup.close()})},a.faqPagination=function(){$(window).innerWidth()<=320?a.maxSize=2:a.maxSize=3,a.numPerPage=10,a.currentPage=1,a.setPage=function(a){console.log("Page No."+a)},a.totalItems=a.faqData.categories.map(function(a,b,c){return a.questionList.length}).reduce(function(a,b,c,d){return a+b}),a.pageChanged=function(){c.log("Page changed to: "+a.currentPage)}},a.updatePaginationItemCount=function(b){a.totalItems=b,a.currentPage=1},a.showAllQuestions=function(){a.cats=a.faqData.categories,a.all=[];for(var b=0;b<a.cats.length;b++){a.questions=a.faqData.categories[b].questionList;for(var c=0;c<a.questions.length;c++)a.all.push(a.questions[c])}a.updatePaginationItemCount(a.all.length)},a.showQuestionsByCategory=function(b){a.all=[],a.questions=a.faqData.categories[b].questionList;for(var c=0;c<a.questions.length;c++)a.all.push(a.questions[c]);a.updatePaginationItemCount(a.all.length)},a.$watch("faq.search",function(b){a.searchText=b})}]),a.filter("slice",function(){return function(a,b,c){return a.slice(b,c)}}),a.filter("highlight",function(){return function(a,b){if(void 0!==b&&b.length>2){var c=new RegExp("("+b+")","gi");return a.replace(c,"<mark>$1</mark>")}return a}}),a.controller("invoiceCtrl",["$scope","$http","$window","globalMessageService","$filter",function(a,b,c,d,e){a.invoiceList=JSON.parse($("#invoiceList").html()),a.currentStep=1,a.isBtn1Enabled=!1,a.isBtn2Enabled=!1,a.selected={},a.discountExpected={},a.emails={},a.typeOfIssueList=["Price Discrepancy","Freight Discrepancy"],a.showtypeOfIssueDropdown=!1,a.isInvoiceNumberNotExist=!1,a.isInvoiceNumberDiscrepancySent=!1,a.showInvoiceNumberDiscrepancySentError=!1,a.isBDEUser=$("#isBDEUserEnabled").val(),a.isBDEUser?a.isBtn3Enabled=!1:a.isBtn3Enabled=!0;var f=$("#currentB2BUnitUID").val();trackInvoiceDiscrepancyStepProcess($("#stepOneProcessTitle").val()),$("a:not(.btn-link), .highlight-link").live("click",function(b){$("body.unsaved-changes").length&&(a.destinationURL=document.activeElement.href,void 0==a.destinationURL&&void 0!=$(this).attr("data-url")&&(a.destinationURL=$(this).attr("data-url")),b.preventDefault(),a.showCancelInvoiceDiscrepancyPopup(b))}),a.desktopSize=992,a.mobileSize=768,a.updateTableColumnWhenResize=function(){a.tableColumn=1,a.tableColumnBtnActive="right",a.widthSize=c.innerWidth,a.widthSize>=a.mobileSize?a.tableColumnMax=2:a.tableColumnMax=3},a.updateTableColumnWhenResize(),a.widthSize<a.mobileSize&&$(".item-data-table .table-body-container").swipe({swipe:function(b,c,d,e,f,g){"right"===c?a.showTableColumnLeft():"left"===c&&a.showTableColumnRight(),a.$apply()},threshold:0,allowPageScroll:"auto",excludedElements:"input, label, .table-arrow"}),angular.element(c).bind("resize",function(){a.updateTableColumnWhenResize(),a.$digest()}),a.selectFromDropdown=function(a,b){angular.element(a.currentTarget).parents(".custom-dropdown").find('input[type="text"]').html(b).val(b)},a.getInvoiceItemDataFromPopup=function(c){b({url:$("#invoiceItemDataUrl").val(),method:"POST",data:{invoiceNumber:a.invoiceNumber,soldTo:f}}).then(function(b){a.invoiceItemData=b.data,a.setTotals(a.invoiceItemData.invoices),a.freightCharged=a.invoiceItemData.freightChargedAmount,a.invoiceDate=a.invoiceItemData.invoiceDate,$.magnificPopup.close(),a.typeOfIssue===a.typeOfIssueList[1]&&(a.widthSize>=a.mobileSize?a.tableColumn=2:a.tableColumn=3,a.tableColumnBtnActive="left"),a.currentStep=a.currentStep+1,a.trackStepProcess(c)})},a.getColumnCount=function(a){return new Array(a)},a.updateTableColumn=function(b,c){a.tableColumn=b,b>1&&b<a.tableColumnMax?a.tableColumnBtnActive="both":1==b?a.tableColumnBtnActive="right":b==a.tableColumnMax&&(a.tableColumnBtnActive="left")},a.showTableColumnRight=function(){a.tableColumn<a.tableColumnMax&&(a.tableColumn=a.tableColumn+1,a.tableColumn>1&&a.tableColumn<a.tableColumnMax?a.tableColumnBtnActive="both":a.tableColumn===a.tableColumnMax&&(a.tableColumnBtnActive="left"))},a.showTableColumnLeft=function(){1!==a.tableColumn&&(a.tableColumn=a.tableColumn-1,a.tableColumn>1&&a.tableColumn<a.tableColumnMax?a.tableColumnBtnActive="both":1===a.tableColumn&&(a.tableColumnBtnActive="right"))},a.goToNextStep=function(c){if(1===a.currentStep&&b({url:$("#invoiceValidationUrl").val(),method:"POST",data:{invoiceNumber:a.invoiceNumber,soldTo:f}}).then(function(d){var e=d.data;e.invoiceInSAP?(e.invoiceDiscrepencyRequestRaised?$.magnificPopup.open({items:{src:"#invoiceDiscrepancyAlreadyRaisedPopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",modal:!0}):b({url:$("#invoiceItemDataUrl").val(),method:"POST",data:{invoiceNumber:a.invoiceNumber,soldTo:f}}).then(function(b){a.invoiceItemData=b.data,a.setTotals(a.invoiceItemData.invoices),a.freightCharged=a.invoiceItemData.freightChargedAmount,a.invoiceDate=a.invoiceItemData.invoiceDate,a.typeOfIssue===a.typeOfIssueList[1]&&(a.widthSize>=a.mobileSize?a.tableColumn=2:a.tableColumn=3,a.tableColumnBtnActive="left"),a.currentStep=a.currentStep+1,a.trackStepProcess(c)}),a.isInvoiceNumberNotExist=!1):a.isInvoiceNumberNotExist=!0}),2===a.currentStep&&(a.invoiceItemDataObject=[],"Price Discrepancy"===a.typeOfIssue?angular.forEach(a.invoiceItemData.invoices,function(b){a.selected[b.itemID]&&a.invoiceItemDataObject.push({itemDescriptionLine1:b.itemDescriptionLine1,itemDescriptionLine2:b.itemDescriptionLine2,material:b.material,quantity:b.quantity,discountReceived:b.discount,discountExpected:a.removeDollarSign(a.discountExpected[b.itemID])})}):"Freight Discrepancy"===a.typeOfIssue&&angular.forEach(a.invoiceItemData.invoices,function(b){a.invoiceItemDataObject.push({itemDescriptionLine1:b.itemDescriptionLine1,itemDescriptionLine2:b.itemDescriptionLine2,material:b.material,quantity:b.quantity})}),b.get("/your-business/"+$("#notificationListUrl").val()).then(function(b){a.notificationUsers=b.data.customers,a.notificationUsers=e("orderBy")(a.notificationUsers,"name")}),a.trackStepProcess(c)),3===a.currentStep){var d={},g="Price Discrepancy"===a.typeOfIssue?"PRICE":"FREIGHT";"Price Discrepancy"===a.typeOfIssue?d={invoiceNumber:a.invoiceNumber,invoiceDate:a.invoiceDate,soldTo:f,raisedByBDE:!!a.isBDEUser,invoiceType:g,invoices:a.invoiceItemDataObject,requestDescription:a.message,notificationList:void 0!==a.notificationListObject?a.notificationListObject:[$("#curEmail").val()]}:"Freight Discrepancy"===a.typeOfIssue&&(d={invoiceNumber:a.invoiceNumber,invoiceDate:a.invoiceDate,soldTo:f,raisedByBDE:!!a.isBDEUser,invoiceType:g,invoices:a.invoiceItemDataObject,freightChargedAmount:a.freightCharged,freightExpectedAmount:a.removeDollarSign(a.freightExpected),requestDescription:a.message,notificationList:void 0!==a.notificationListObject?a.notificationListObject:[$("#curEmail").val()]}),$(".breadcrumb").addClass("inactive"),rm.utilities.loadingMessage($(".loading-message").data("request"),!0),$("body").addClass("loading"),b({url:"/your-business/saveInvoiceDiscrepancyRequest",method:"POST",data:d}).then(function(b){$(".breadcrumb").removeClass("inactive"),$("body").removeClass("loading"),b.data?($("body").removeClass("unsaved-changes"),a.isInvoiceNumberDiscrepancySent=!0,a.trackStepProcess(c)):a.showInvoiceNumberDiscrepancySentError=!0})}1!==a.currentStep&&3!==a.currentStep&&(a.currentStep=a.currentStep+1)},a.goToPrevStep=function(){a.currentStep>1&&(a.currentStep=a.currentStep-1)},a.validateForm=function(){$("body").addClass("unsaved-changes"),a.invoiceNumber=$("#invoiceNumber").val(),a.typeOfIssue=$("#typeOfIssue").val(),1===a.currentStep&&(void 0!==a.invoiceNumber&&""!==a.typeOfIssue&&a.form.invoiceNumber.$valid?a.isBtn1Enabled=!0:a.isBtn1Enabled=!1),2===a.currentStep&&("Price Discrepancy"===a.typeOfIssue?(a.discountExpectedInput=[],a.selectedInput=[],angular.forEach(a.invoiceItemData.invoices,function(b){a.discountExpected[b.itemID]&&a.discountExpectedInput.push(a.discountExpected[b.itemID]),a.selected[b.itemID]&&a.selectedInput.push(a.selected[b.itemID])}),a.selectedInput.length>0&&a.discountExpectedInput.length===a.selectedInput.length?a.isBtn2Enabled=!0:a.isBtn2Enabled=!1):"Freight Discrepancy"===a.typeOfIssue&&(a.freightExpected?a.isBtn2Enabled=!0:a.isBtn2Enabled=!1)),3===a.currentStep&&(a.notificationListObject=[],a.userRoleListObject=[],a.selectedNonBDEObject=[],$('.notification-list .selected input[type="checkbox"]').is(":checked")&&(a.notificationListObject.push($("#curEmail").val()),a.userRoleListObject.push($("#curUserRole").val())),angular.forEach(a.notificationUsers,function(b){a.emails[b.uid]&&(a.notificationListObject.push(b.uid),a.userRoleListObject.push(b.userRole))}),angular.forEach(a.userRoleListObject,function(b){-1==b.indexOf("bde-user")&&a.selectedNonBDEObject.push(b)}),a.selectedNonBDEObject.length>0?a.isBtn3Enabled=!0:a.isBtn3Enabled=!1)},a.showCancelInvoiceDiscrepancyPopup=function(a){a.preventDefault(),$.magnificPopup.open({items:{src:"#cancelInvoiceDiscrepancyPopup",type:"inline"},removalDelay:500,mainClass:"mfp-slide",modal:!0,callbacks:{open:function(){},close:function(){}}})},a.cancelForm=function(){a.resetFormFieldData(),$("body.unsaved-changes").length?window.location.href=a.destinationURL:window.location.href=$(".cancel-invoice-discrepancy").attr("href"),$("body").removeClass("unsaved-changes"),$.magnificPopup.close()},a.resetFormFieldData=function(){a.currentStep=1,a.form.$setPristine(),a.typeOfIssue="",a.invoiceNumber="",a.isBtn1Enabled=!1,a.isBtn2Enabled=!1},a.checkAll=function(){angular.forEach(a.invoiceItemData.invoices,function(b){a.selected[b.itemID]=a.selectAll})},a.setTotals=function(b){var c=0,d=0,f=0,g=0,h=0,i=0,j=0;if(!angular.isUndefined(b))for(var k=0;k<b.length;k++)c+=isNaN(b[k].quantity)||null==b[k].quantity?0:parseInt(b[k].quantity),d+=isNaN(b[k].discount)||null==b[k].discount?0:parseFloat(b[k].discount),f+=isNaN(b[k].amount)||null==b[k].amount?0:parseFloat(b[k].amount),g+=isNaN(b[k].containerDeposit)||null==b[k].containerDeposit?0:parseFloat(b[k].containerDeposit),h+=isNaN(b[k].wet)||null==b[k].wet?0:parseFloat(b[k].wet),i+=isNaN(b[k].totalExGST)||null==b[k].totalExGST?0:parseFloat(b[k].totalExGST),j+=isNaN(b[k].localFreight)||null==b[k].localFreight?0:parseFloat(b[k].localFreight);a.totalQty=e("number")(c,0),a.totalDiscount=e("number")(d,2),a.totalAmount=e("number")(f,2),a.totalContainerDeposit=e("number")(g,2),a.totalWet=e("number")(h,2),a.totalExGST=e("number")(i,2),a.totalLocalFreight=e("number")(j,2)},a.appendDollarSign=function(a){var b=angular.element(a.currentTarget);""!==b.val()&&"$"==b.val()[0]||b.val("$");var c=b.val();b.val("").val(c)},a.removeDollarSign=function(a){return-1!=a.indexOf("$")&&(a=a.replace(/\$/g,"")),a},a.trackStepProcess=function(a){if(void 0===angular.element(a.currentTarget).attr("isclicked")){angular.element(a.currentTarget).attr("isclicked",!0);var b=angular.element(a.currentTarget).attr("data-title");trackInvoiceDiscrepancyStepProcess(b)}}}]),a.controller("raisedInvoiceDiscrepancyCtrl",["$scope","$http","$log","$window","$filter","globalMessageService",function(a,b,c,d,e,f){a.desktopSize=992,a.mobileSize=768,a.trackResize=function(){a.widthSize=d.innerWidth},a.checkOrientation=function(){d.matchMedia("(orientation: portrait)").matches&&(a.orientation="Portait"),d.matchMedia("(orientation: landscape)").matches&&(a.orientation="Landscape")},a.trackResize(),a.checkOrientation(),angular.element(d).bind("resize",function(){a.trackResize(),a.checkOrientation()}),a.today=new Date,a.raisedInvoicesList=JSON.parse($("#raisedInvoicesList").html()),a.raisedInvoicesList.map(function(a,b){var c=a.raisedDate.split("/");a.raisedOn=new Date(c[2]+"-"+c[1]+"-"+c[0]);var d=a.expectedTotalAmount.replace("$","");return a.expectedTotal=parseFloat(d),a}),a.raisedInvoicesList=e("orderBy")(a.raisedInvoicesList,"-raisedOn"),a.viewInvoiceDiscrepancyByIDPopup=function(b){var c=a.raisedInvoicesList.map(function(a){return a.invoiceNumber}).indexOf(b);$.magnificPopup.open({items:{src:"#invoiceDiscrepancyAlreadyRaisedPopup"+b,type:"inline"},removalDelay:500,mainClass:"mfp-slide",modal:!0,callbacks:{open:function(){a.modalData=a.raisedInvoicesList[c]}}})},a.referenceNumberCoverter=function(a){return a<=9?"000"+a:a<=99?"00"+a:a<=999?"0"+a:a},$("#raisedInvoiceDiscrepancyUpdateFilter").on("click",function(){var b={startDate:$(".invoicedate-start").attr("data-value"),endDate:$(".invoicedate-end").attr("data-value"),forUnit:$("#forUnit").attr("data-value")};$.ajax({global:!1,url:"/your-business/raisedinvoicediscrepancybydaterange",data:b,method:"POST",dataType:"json",success:function(b){a.raisedInvoicesList=b,a.$apply()}})}),a.faqPagination=function(){a.numPerPage=25,a.currentPage=1,a.setPage=function(a){c.log("Page No."+a)},a.totalItems=a.raisedInvoicesList.length,c.log(a.totalItems),a.pageChanged=function(){c.log("Page changed to: "+a.currentPage)}},a.faqPagination(),a.sortColumn="raisedOn",a.reverseSort=!0,a.sortData=function(b){a.reverseSort=b===a.sortColumn&&!a.reverseSort,a.sortColumn=b,a.getSortClass(b)},a.getSortClass=function(b){return b===a.sortColumn?a.reverseSort?"footable-sorted":"footable-sorted-desc":""}}]),a.directive("qtySelector",["$parse",function(a){return{restrict:"A",link:function(a,b,c){$(b).on("click touchstart",function(){setTimeout(function(){a.base.newQty=$(b).parent(".select-quantity").find(".qty-input").val(),$(b).parents(".deal").find(".deal-item-head").hasClass("single")?a.$parent.deal.ranges[0].totalQty=a.calcTotalQty(a.$parent.deal,a.$parent.deal.ranges[0]):a.$parent.range.totalQty=a.calcTotalQty(a.$parent.$parent.deal,a.$parent.range),a.$apply()},10)})}}}]),a.directive("emailChecker",function(){return function(a,b,c){console.log(a),$(b).on("click",function(){$(this).val();console.log("clicked")})}}),a.directive("qtySelectorService",["$parse","$timeout",function(a,b){return{restrict:"A",link:function(a,c,d){$(c).on("click touchstart",function(){b(function(){var b=$(c).parent(".select-quantity").find(".qty-input").attr("data-scope"),d=$(c).parent(".select-quantity").find(".qty-input").attr("data-val");a[b][d]=$(c).parent(".select-quantity").find(".qty-input").val()},10)})}}}]),angular.module("NgSwitchery",[]).directive("uiSwitch",["$window","$timeout","$log","$parse",function(a,b,c,d){function e(c,e,f,g){function h(){b(function(){j&&angular.element(j.switcher).remove(),j=new a.Switchery(e[0],i);var b=j.element;b.checked=c.initValue,f.disabled&&j.disable(),j.setPosition(!1),b.addEventListener("change",function(a){c.$apply(function(){g.$setViewValue(b.checked)})})},0)}if(!g)return!1;var i={};try{i=d(f.uiSwitch)(c)}catch(a){}var j;f.$observe("disabled",function(a){j&&(a?j.disable():j.enable())}),h()}return{require:"ngModel",restrict:"AE",scope:{initValue:"=ngModel"},link:e}}])}else setTimeout(waitForElement,250)}void 0===parent.smarteditJQuery&&$("#CUB").attr("ng-app","CUB"),waitForElement();