/**
 *
 */
package com.sabmiller.core.product;

import de.hybris.platform.core.model.product.UnitModel;
import de.hybris.platform.product.impl.DefaultUnitService;

import java.util.Arrays;

import org.apache.log4j.Logger;

import com.sabmiller.core.constants.SabmCoreConstants;
import com.sabmiller.core.model.ProductUOMMappingModel;


/**
 * @author joshua.a.antony
 *
 */
public class DefaultSabmUnitService extends DefaultUnitService implements SabmUnitService
{

	private static final Logger LOG = Logger.getLogger(DefaultSabmUnitService.class);



	@Override
	public UnitModel createUnit(final String code)
	{
		UnitModel unit = null;
		try
		{
			unit = getUnitForCode(code);
		}
		catch (final Exception e)
		{
			LOG.debug("UOM not found, create a new one!", e);
		}
		if (unit == null)
		{
			unit = new UnitModel();
			unit.setCode(code);
			unit.setUnitType("<autogenerated unit type>");
			unit.setConversion(Double.valueOf(1.0));
			getModelService().save(unit);
		}
		return unit;
	}


	/*
	 * (non-Javadoc)
	 *
	 * @see com.sabmiller.core.product.SabmUnitService#isValid(com.sabmiller.core.model.ProductUOMMappingModel)
	 */
	@Override
	public boolean isValid(final ProductUOMMappingModel uomMappingModel)
	{
		return uomMappingModel.getFromUnit() != null && uomMappingModel.getToUnit() != null && Arrays.asList(new String[]
		{ SabmCoreConstants.CASE_UOM_CODE, SabmCoreConstants.CASE_UOM_ALTERNATE_CODE1 })
				.contains(uomMappingModel.getToUnit().getCode()) && Arrays.asList(new String[]
		{ SabmCoreConstants.PALLET_UOM_CODE, SabmCoreConstants.LAYER_UOM_CODE }).contains(uomMappingModel.getFromUnit().getCode());
	}
}
