<%@ page trimDirectiveWhitespaces="true"%>
<%@ taglib prefix="c" uri="jakarta.tags.core"%>
<%@ taglib prefix="fn" uri="jakarta.tags.functions"%>
<%@ taglib prefix="cms" uri="http://hybris.com/tld/cmstags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>

<input type="hidden" name="selectedL2" value="" />
<input type="hidden" name="selectedL3" value="" />
<c:if test="${component.visible}">
	<nav class="navigation navigation--bottom js_navigation--bottom js-enquire-offcanvas-navigation" role="navigation">
		<ul class="sticky-nav-top hidden-lg hidden-md js-sticky-user-group hidden-md hidden-lg">
            <%-- Dynamically generated by acc.navigation.js--%> </%-->
        </ul>
		<div class="navigation__overflow">
			<sec:authorize access="!hasAnyRole('ROLE_ANONYMOUS')">
				<div class="multiaccount-mobilenav multiaccount-mobilenav-section hidden-md hidden-lg">
						<div class="multiaccount-mobilenav-text">${defaultB2BUnitCode} - ${defaultB2BUnitName}</div>
						<div class="multiaccount-mobilenav multiaccount-switch">
							<strong><a href="<c:url value='/multiAccount'/>"><spring:theme code="apb.sga.multiaccount.switch"/></a></strong>
						</div>
				</div>

				<!-- Recommendation count -->
                <sec:authorize access="hasAnyRole('ROLE_BDECUSTOMERGROUP')" >
                    <ul class="nav__links nav__links--mobile hidden-md hidden-lg">
                        <li class="auto">
                            <div class="myAccountLinksContainer">
                                <div class="sub-nav recommendation-nav">
                                    <a class="recommendation-link inline-block" href="<c:url value='/recommendation'/>" ><spring:theme code="rep.recommendation.breadcrumb" /></a>
                                    <div class="image-container position-relative inline-block">
                                        <img src="${commonResourcePath}/images/Star_Orange.svg" />
                                        <span class="recommendation-count inline-block position-absolute">${recommendationsCount}</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </sec:authorize>

				<ul data-trigger="#signedInUserOptionsToggle" class="nav__links nav__links--products nav__links--mobile js-userAccount-Links js-nav-collapse-body offcanvasGroup1 collapse in hidden-md hidden-lg">
					<%-- Dynamically generated by acc.navigation.js--%>  </%-->
				</ul>
			</sec:authorize>
			
            <div class="col-md-2 col-lg-2 desktop-nav-col-1">		<!--		One extra class for SGA			-->
            </div>

            <div class="col-md-8 col-lg-8 desktop-nav-col-2">		<!--		One extra class for SGA			-->
            <a id="shopByCategoryToggle" class="hidden-md hidden-lg myAccountLinksHeader" data-toggle="collapse" href="#shopByCategoryLinks"><span id="shopByCategoryToggleIcon" class="glyphicon glyphicon-minus"></span>Shop By Category</a>
           	<ul id="shopByCategoryLinks" class="nav__links nav__links--products collapse in js-shop-by-links-body js-offcanvas-links">
				<c:forEach items="${component.navigationNode.children}" var="childLevel1"> 
					<li class="auto nav__links--primary <c:if test="${not empty childLevel1.children}">nav__links--primary-has__sub js-enquire-has-sub primary-link-l2</c:if>">
						<c:forEach items="${childLevel1.entries}" var="childlink1">
							<cms:component component="${childlink1.item}" evaluateRestriction="true" element="span" class="nav__link js_nav__link js_nav__link--drill__down" />
						</c:forEach>
						
						<%-- Calculate how many sub columns are needed -- Start --%>
						<c:set var="totalSubNavigationColumns" value="${0}"/>
						<c:set var="hasSubChild" value="false"/>
						<c:forEach items="${childLevel1.children}" var="childLevel2"> 
							<c:if test="${not empty childLevel2.children}">
								<c:set var="hasSubChild" value="true"/>
								<c:set var="subSectionColumns" value="${fn:length(childLevel2.children)/component.wrapAfter}"/>
								
								<!--  subSectionColumns  ${subSectionColumns}  -->
								<c:if test="${subSectionColumns > 1 && fn:length(childLevel2.children)%component.wrapAfter > 0}">
									<c:set var="subSectionColumns" value="${subSectionColumns + 1}"/>
								</c:if>
								<c:choose>
									<c:when test="${subSectionColumns > 1}">
										<c:set var="totalSubNavigationColumns" value="${totalSubNavigationColumns + subSectionColumns}" />
									</c:when>
			
									<c:when test="${subSectionColumns < 1}">
										<c:set var="totalSubNavigationColumns" value="${totalSubNavigationColumns + 1}" />
									</c:when>
								</c:choose>
							</c:if>
						</c:forEach>
						<%-- Calculate how many sub columns are needed -- End --%>
							<!--  subSectionColumns  ${subSectionColumns}  subNavigationClass ${subNavigationClass} subNavigationItemClass ${subNavigationItemClass}  -->
						<%-- Decide which class to use -- Start --%>
						<c:choose>
							<c:when test="${!hasSubChild || (totalSubNavigationColumns > 0 && totalSubNavigationColumns <= 1)}">
								<c:set value="col-md-3 col-lg-2" var="subNavigationClass"/>
								<c:set value="col-md-12" var="subNavigationItemClass"/>
							</c:when>
		
							<c:when test="${totalSubNavigationColumns == 2}">
								<c:set value="col-md-6 col-lg-4" var="subNavigationClass"/>
								<c:set value="col-md-6" var="subNavigationItemClass"/>
							</c:when>
							
							<c:when test="${totalSubNavigationColumns == 3}">
								<c:set value="col-md-9 col-lg-6" var="subNavigationClass"/>
								<c:set value="col-md-4" var="subNavigationItemClass"/>
							</c:when>
		
							<c:when test="${totalSubNavigationColumns == 4}">
								<c:set value="col-md-12 col-lg-8" var="subNavigationClass"/>
								<c:set value="col-md-3" var="subNavigationItemClass"/>
							</c:when>
		
							<c:when test="${totalSubNavigationColumns == 5}">
								<c:set value="col-md-12" var="subNavigationClass"/>
                                <%--custom grid class required because 1/5th columns arent supported by bootstrap--%> </%--custom>
								<c:set value="column-20-percent" var="subNavigationItemClass"/>
							</c:when>
		
							<c:when test="${totalSubNavigationColumns > 5}">
								<c:set value="col-md-12" var="subNavigationClass"/>
								<c:set value="col-md-2" var="subNavigationItemClass"/>
							</c:when>
						</c:choose>
						<%-- Decide which class to use -- End --%>
						
                        <c:if test="${not empty childLevel1.children}"><span class="glyphicon  glyphicon-menu-right hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down"></span>
                            <div class="sub__navigation js_sub__navigation ${subNavigationClass}">
                                <a class="sm-back js-enquire-sub-close hidden-md hidden-lg" href="#">Back</a>
                                <div class="line-seperator hidden-md hidden-lg"></div>
								
                           
								
								<c:forEach items="${childLevel1.entries}" var="cat2">
									<c:url value="${cat2.item.url}" var="categoryLink"/>
								<a class="show-all-link hidden-md hidden-lg" href="${categoryLink}">Show all <c:out value="${cat2.item.linkName}"/></a>
								</c:forEach>
								
								
                                <div id="header-subnavigation" class="">
                                    <c:choose>
                                        <c:when test="${hasSubChild}">
                                            <c:forEach items="${childLevel1.children}" var="childLevel2">
                                                <div class="sub-navigation-section ">

                                                    <!--<%-- 	
                                                    										<c:if test="${not empty childLevel2.title}"> --%>-->
                                                    <div class="nav_link--secondary-level-3">	
                                                    <div class="title">
                                                        <c:forEach items="${childLevel2.entries}" var="childlink2Head">
                                                            <cms:component component="${childlink2Head.item}" evaluateRestriction="true" element="span" class="nav__link--secondary js_nav__link--drill__down__level2" />
                                                        </c:forEach>
                                                        <c:if test="${not empty childLevel1.children}"><span class="glyphicon  glyphicon-menu-right hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down__level2 "></span></c:if>
                                                    </div>
                                                    </div>	
                                                    <!--<%-- 													</c:if> --%>-->
<!--                                                    THIS IS THE CODE FOR GETTING LEVEL 3 CATEGORIES IN THE HAMBURGER MENU!-->
								
                                                    <ul class="hidden-xs hidden-sm sub-navigation-list <c:if test=" ${not empty childLevel2.title} ">has-title</c:if>">
                                                        <c:forEach items="${childLevel2.children}" var="childLevel3" step="${component.wrapAfter}" varStatus="i">
<!--                                                     <%-- wrap if more than 'component.wrapAfter' rows in one sub column --%>-->
                                                            <c:if test="${i.index>=component.wrapAfter}">
                                                                <c:if test="${!i.first}">
                                                                </c:if>
                                                                <div class="sub-navigation-section ${subNavigationItemClass}">
                                                                    <ul class="sub-navigation-list <c:if test=" ${not empty childLevel2.title} ">has-title</c:if>">
                                                                    </ul>
                                                                </div>
                                                            </c:if>
                                                            <c:forEach items="${childLevel2.children}" var="childLevel3" begin="${i.index}" end="${i.index + component.wrapAfter - 1}">
                                                                <c:forEach items="${childLevel3.entries}" var="childlink3">
                                                                    <cms:component component="${childlink3.item}" evaluateRestriction="true" element="li" class="nav__link--secondary" />
                                                                </c:forEach>
                                                            </c:forEach>
                                                        </c:forEach>
                                                    </ul>
                                                    
                                                    <div class="hidden-md hidden-lg sub-navigation-level-3">
                                						
                                						<ul class="sub-navigation-list <c:if test=" ${not empty childLevel2.title} ">has-title</c:if>">
                                                        <c:forEach items="${childLevel2.children}" var="childLevel3" step="${component.wrapAfter}" varStatus="i">
<!--                                                     <%-- wrap if more than 'component.wrapAfter' rows in one sub column --%>-->
                                                            <c:if test="${i.index>=component.wrapAfter}">
                                                                <c:if test="${!i.first}">
                                                                </c:if>
                                                                <div class="sub-navigation-section ${subNavigationItemClass}">
                                                                    <ul class="sub-navigation-list <c:if test=" ${not empty childLevel2.title} ">has-title</c:if>">
                                                                    </ul>
                                                                </div>
                                                            </c:if>
                                                            <c:forEach items="${childLevel2.children}" var="childLevel3" begin="${i.index}" end="${i.index + component.wrapAfter - 1}">
                                                                <c:forEach items="${childLevel3.entries}" var="childlink3">
                                                                    <cms:component component="${childlink3.item}" evaluateRestriction="true" element="li" class="nav__link--secondary" />
                                                                </c:forEach>
                                                            </c:forEach>
                                                        </c:forEach>
                                                    </ul>
                                						
                                					
                                                    </div>
                                                    
                                                </div>
                                            </c:forEach>
                                        </c:when>
                                        <c:otherwise>
                                            <div class="sub-navigation-section ${subNavigationItemClass}">
                                                <ul class="sub-navigation-list <c:if test=" ${not empty childLevel2.title} ">has-title</c:if>">
                                                    <c:forEach items="${childLevel1.children}" var="childLevel2">
                                                        <c:forEach items="${childLevel2.entries}" var="childlink2">
                                                            <cms:component component="${childlink2.item}" evaluateRestriction="true" element="li" class="nav__link--secondary" />
                                                        </c:forEach>
                                                    </c:forEach>
                                                </ul>
                                            </div>
                                        </c:otherwise>
                                    </c:choose>
                                </div>
                            </div>
                        </c:if>
					</li>
				</c:forEach>
			 </ul>
            </div>
            
            <div class="search-bar-header">
                <div class="hidden-xs hidden-sm col-md-2 col-lg-2 desktop-nav-col-1">			<!--		One extra class for SGA			-->
                    <div class="site-search mr-30">
                                                <cms:pageSlot position="SearchBox" var="component">
                                                    <cms:component component="${component}" element="div"/>
                                                </cms:pageSlot>
                    </div>
                </div>
            </div>
		</div>
	</nav>
</c:if>